import React, { useState, useEffect } from 'react';
import {
  Building, Package, TrendingDown, Calendar, AlertTriangle,
  CheckCircle, Calculator, FileText, BarChart3, Settings,
  Plus, Edit, Trash2, Search, Filter, Download, Upload,
  Eye, Clock, DollarSign, Activity, Tag, MapPin, Wrench,
  Archive, RefreshCw, ChevronRight, Info, Camera, QrCode,
  Brain, Wifi, Smartphone, Cloud, Zap, Users, Shield,
  Database, Cpu, Radio, Monitor, Globe, Link, X
} from 'lucide-react';
import { ModernCard, CardHeader, CardBody, StatCard } from '../../components/ui/ModernCard';
import ModernButton from '../../components/ui/ModernButton';

interface Asset {
  id: string;
  asset_number: string;
  description: string;
  asset_class: string;
  asset_category: string;
  asset_identification: string;
  uom_group: string;
  capital_appropriation_number: string;

  // Location and assignment
  location: string;
  technician: string;
  employee: string;

  // Dates
  capitalization_date: string;
  acquisition_date: string;
  warranty_end: string;
  last_inventory: string;

  // Financial data
  acquisition_cost: number;
  historical_apc: number; // Accumulated Provision for Depreciation
  net_book_value: number;
  historical_nbc: number; // Net Book Cost
  ordinary_depreciation: number;
  unplanned_depreciation: number;
  special_depreciation: number;
  write_up: number;
  salvage_value: number;

  // Depreciation
  asset_group: string;
  depreciation_group: string;
  depreciation_method: string;
  depreciation_rate: number;

  // Additional fields
  serial_number: string;
  quantity: number;
  status: 'active' | 'inactive' | 'maintenance' | 'disposed' | 'en_service';
  supplier: string;
  department: string;
  notes: string;

  // Legacy fields for compatibility
  code: string;
  designation: string;
  category: string;
  subcategory: string;
  acquisition_value: number;
  current_value: number;
  cumulated_depreciation: number;
  net_value: number;
  responsible: string;
}

interface CompleteAssetsModulesDetailedProps {
  activeModule?: number;
}

export const CompleteAssetsModulesDetailed: React.FC<CompleteAssetsModulesDetailedProps> = ({
  activeModule = 1
}) => {
  const [assets, setAssets] = useState<Asset[]>([]);
  const [filteredAssets, setFilteredAssets] = useState<Asset[]>([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterCategory, setFilterCategory] = useState('all');
  const [filterStatus, setFilterStatus] = useState('all');
  const [sortBy, setSortBy] = useState('designation');
  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc');
  const [viewMode, setViewMode] = useState<'table' | 'cards'>('table');
  const [selectedAsset, setSelectedAsset] = useState<Asset | null>(null);
  const [showAssetModal, setShowAssetModal] = useState(false);

  // États pour toutes les modales
  const [showNewAssetModal, setShowNewAssetModal] = useState(false);
  const [showEditAssetModal, setShowEditAssetModal] = useState(false);
  const [showImportModal, setShowImportModal] = useState(false);
  const [showExportModal, setShowExportModal] = useState(false);
  const [showQrScannerModal, setShowQrScannerModal] = useState(false);
  const [showDeleteConfirmModal, setShowDeleteConfirmModal] = useState(false);
  const [assetToDelete, setAssetToDelete] = useState<Asset | null>(null);
  const [assetToEdit, setAssetToEdit] = useState<Asset | null>(null);
  const [activeFormTab, setActiveFormTab] = useState('general');
  const [activeImmobilisationTab, setActiveImmobilisationTab] = useState('overview');
  const [activeGeneralTab, setActiveGeneralTab] = useState('basic');

  // Services d'intégration pour les données automatiques
  const [capitationData, setCapitationData] = useState<{
    capital_appropriation_number: string;
    asset_class: string;
    employee: string;
  } | null>(null);

  const [wiseFMData, setWiseFMData] = useState<{
    technician: string;
    department: string;
    maintenance_contract: string;
  } | null>(null);

  // États pour le formulaire de nouvel actif
  const [newAssetForm, setNewAssetForm] = useState({
    asset_number: '',
    description: '',
    asset_class: '',
    asset_category: '',
    asset_identification: '',
    uom_group: '',
    capital_appropriation_number: '',
    location: '',
    technician: '',
    employee: '',
    capitalization_date: '',
    acquisition_date: '',
    warranty_end: '',
    acquisition_cost: 0,
    historical_apc: 0,
    net_book_value: 0,
    historical_nbc: 0,
    ordinary_depreciation: 0,
    unplanned_depreciation: 0,
    special_depreciation: 0,
    write_up: 0,
    salvage_value: 0,
    asset_group: '',
    depreciation_group: '',
    depreciation_method: '',
    serial_number: '',
    quantity: 1,
    supplier: '',
    department: '',
    notes: '',
    // Legacy fields
    code: '',
    designation: '',
    category: '',
    subcategory: '',
    acquisition_value: 0,
    responsible: ''
  });

  // Fonctions d'intégration pour récupérer les données automatiques
  const fetchCapitationData = async (capitationId?: string) => {
    try {
      // Simulation d'appel API vers le système de capitation
      // En production, remplacer par un vrai appel API
      const response = await fetch(`/api/capitation/${capitationId || 'current'}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      });

      if (response.ok) {
        const data = await response.json();
        setCapitationData({
          capital_appropriation_number: data.capital_appropriation_request_number,
          asset_class: data.asset_class,
          employee: data.employee_name
        });

        // Auto-remplir le formulaire
        setNewAssetForm(prev => ({
          ...prev,
          capital_appropriation_number: data.capital_appropriation_request_number,
          asset_class: data.asset_class,
          employee: data.employee_name
        }));
      }
    } catch (error) {
      console.error('Erreur lors de la récupération des données de capitation:', error);
      // Données mock pour développement
      const mockCapitationData = {
        capital_appropriation_number: 'CAR-2024-AUTO-001',
        asset_class: '24 - matériel, mobilier',
        employee: 'Fatima Ndiaye'
      };
      setCapitationData(mockCapitationData);
      setNewAssetForm(prev => ({
        ...prev,
        ...mockCapitationData
      }));
    }
  };

  const fetchWiseFMData = async (contractId?: string) => {
    try {
      // Simulation d'appel API vers WiseFM
      const response = await fetch(`/api/wisefm/contracts/${contractId || 'current'}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      });

      if (response.ok) {
        const data = await response.json();
        setWiseFMData({
          technician: data.assigned_technician,
          department: data.department,
          maintenance_contract: data.contract_number
        });

        // Auto-remplir le formulaire
        setNewAssetForm(prev => ({
          ...prev,
          technician: data.assigned_technician,
          department: data.department
        }));
      }
    } catch (error) {
      console.error('Erreur lors de la récupération des données WiseFM:', error);
      // Données mock pour développement
      const mockWiseFMData = {
        technician: 'Amadou Diallo',
        department: 'Maintenance',
        maintenance_contract: 'WFM-2024-001'
      };
      setWiseFMData(mockWiseFMData);
      setNewAssetForm(prev => ({
        ...prev,
        technician: mockWiseFMData.technician,
        department: mockWiseFMData.department
      }));
    }
  };

  // Mock data for demonstration
  useEffect(() => {
    const mockAssets: Asset[] = [
      {
        id: '1',
        asset_number: '235377',
        description: 'ARIC TRAVAUX D\'ASSAINISSEMENT',
        asset_class: '24 - matériel, mobilier',
        asset_category: 'Matériel technique',
        asset_identification: 'ID-00333',
        uom_group: 'Unité',
        capital_appropriation_number: 'CAR-2024-001',
        location: 'Dakar Centre',
        technician: 'Amadou Diallo',
        employee: 'Fatima Ndiaye',
        capitalization_date: '2020-01-15',
        acquisition_date: '2020-01-15',
        warranty_end: '2025-01-15',
        last_inventory: '2024-01-15',
        acquisition_cost: 1500000,
        historical_apc: 150000,
        net_book_value: 1350000,
        historical_nbc: 1350000,
        ordinary_depreciation: 37500,
        unplanned_depreciation: 0,
        special_depreciation: 0,
        write_up: 0,
        salvage_value: 50000,
        asset_group: 'IMMOBILIER',
        depreciation_group: 'DEP-IMMO',
        depreciation_method: 'Linéaire',
        depreciation_rate: 2.5,
        serial_number: 'IMM-2020-001',
        quantity: 1,
        status: 'en_service',
        supplier: 'Promoteur Immobilier SARL',
        department: 'Administration',
        notes: 'Bâtiment principal - 3 étages',
        // Legacy fields
        code: 'IMM001',
        designation: 'Bâtiment Siège Social',
        category: 'Immobilier',
        subcategory: 'Bureau',
        acquisition_value: 1500000,
        current_value: 1350000,
        cumulated_depreciation: 150000,
        net_value: 1350000,
        responsible: 'Amadou Diallo'
      },
      {
        id: '2',
        asset_number: '235378',
        description: 'Serveur Dell PowerEdge R750',
        asset_class: '21 - équipement informatique',
        asset_category: 'Matériel informatique',
        asset_identification: 'ID-00334',
        uom_group: 'Unité',
        capital_appropriation_number: 'CAR-2023-045',
        location: 'Salle Serveur',
        technician: 'Mohamed Kane',
        employee: 'Fatima Ndiaye',
        capitalization_date: '2023-03-10',
        acquisition_date: '2023-03-10',
        warranty_end: '2026-03-10',
        last_inventory: '2024-01-10',
        acquisition_cost: 85000,
        historical_apc: 17000,
        net_book_value: 68000,
        historical_nbc: 68000,
        ordinary_depreciation: 17000,
        unplanned_depreciation: 0,
        special_depreciation: 0,
        write_up: 0,
        salvage_value: 5000,
        asset_group: 'INFORMATIQUE',
        depreciation_group: 'DEP-INFO',
        depreciation_method: 'Linéaire',
        depreciation_rate: 20,
        serial_number: 'DELL-2023-R750-001',
        quantity: 1,
        status: 'en_service',
        supplier: 'Dell Technologies',
        department: 'IT',
        notes: 'Configuration 32GB RAM, SSD 2TB',
        // Legacy fields
        code: 'MAT001',
        designation: 'Serveur Dell PowerEdge',
        category: 'Informatique',
        subcategory: 'Serveur',
        acquisition_value: 85000,
        current_value: 68000,
        cumulated_depreciation: 17000,
        net_value: 68000,
        responsible: 'Fatima Ndiaye'
      },
      {
        id: '3',
        asset_number: '235379',
        description: 'Toyota Hilux Double Cabine 4x4',
        asset_class: '23 - véhicules',
        asset_category: 'Véhicule utilitaire',
        asset_identification: 'ID-00335',
        uom_group: 'Unité',
        capital_appropriation_number: 'CAR-2022-078',
        location: 'Garage Principal',
        technician: 'Cheikh Diop',
        employee: 'Moussa Seck',
        capitalization_date: '2022-06-20',
        acquisition_date: '2022-06-20',
        warranty_end: '2024-06-20',
        last_inventory: '2024-01-05',
        acquisition_cost: 18500000,
        historical_apc: 5000000,
        net_book_value: 13500000,
        historical_nbc: 13500000,
        ordinary_depreciation: 2775000,
        unplanned_depreciation: 0,
        special_depreciation: 0,
        write_up: 0,
        salvage_value: 3000000,
        asset_group: 'VEHICULES',
        depreciation_group: 'DEP-VEH',
        depreciation_method: 'Linéaire',
        depreciation_rate: 15,
        serial_number: 'TOYOTA-2022-HILUX-001',
        quantity: 1,
        status: 'maintenance',
        supplier: 'Toyota Sénégal',
        department: 'Commercial',
        notes: 'Entretien préventif en cours',
        // Legacy fields
        code: 'VEH001',
        designation: 'Toyota Hilux',
        category: 'Véhicules',
        subcategory: 'Utilitaire',
        acquisition_value: 18500000,
        current_value: 13500000,
        cumulated_depreciation: 5000000,
        net_value: 13500000,
        responsible: 'Moussa Seck'
      }
    ];
    setAssets(mockAssets);
    setFilteredAssets(mockAssets);
  }, []);

  // Chargement automatique des données d'intégration
  useEffect(() => {
    // Charger les données de capitation au démarrage
    fetchCapitationData();
    // Charger les données WiseFM au démarrage
    fetchWiseFMData();
  }, []);

  // Déclencheur pour le chargement automatique à l'ouverture du modal
  const handleOpenNewAssetModal = () => {
    // Réinitialiser le formulaire
    setNewAssetForm({
      asset_number: '',
      description: '',
      asset_class: '',
      asset_category: '',
      asset_identification: '',
      uom_group: '',
      capital_appropriation_number: '',
      location: '',
      technician: '',
      employee: '',
      capitalization_date: '',
      acquisition_date: '',
      warranty_end: '',
      acquisition_cost: 0,
      historical_apc: 0,
      net_book_value: 0,
      historical_nbc: 0,
      ordinary_depreciation: 0,
      unplanned_depreciation: 0,
      special_depreciation: 0,
      write_up: 0,
      salvage_value: 0,
      asset_group: '',
      depreciation_group: '',
      depreciation_method: '',
      serial_number: '',
      quantity: 1,
      supplier: '',
      department: '',
      notes: '',
      code: '',
      designation: '',
      category: '',
      subcategory: '',
      acquisition_value: 0,
      responsible: ''
    });

    // Charger automatiquement les données intégrées
    fetchCapitationData();
    fetchWiseFMData();

    setShowNewAssetModal(true);
  };

  // Filter and search logic
  useEffect(() => {
    let filtered = assets.filter(asset => {
      const matchesSearch = asset.designation.toLowerCase().includes(searchTerm.toLowerCase()) ||
                          asset.code.toLowerCase().includes(searchTerm.toLowerCase()) ||
                          asset.responsible.toLowerCase().includes(searchTerm.toLowerCase());

      const matchesCategory = filterCategory === 'all' || asset.category === filterCategory;
      const matchesStatus = filterStatus === 'all' || asset.status === filterStatus;

      return matchesSearch && matchesCategory && matchesStatus;
    });

    // Sort assets
    filtered.sort((a, b) => {
      let aValue: any = a[sortBy as keyof Asset];
      let bValue: any = b[sortBy as keyof Asset];

      if (typeof aValue === 'string') {
        aValue = aValue.toLowerCase();
        bValue = bValue.toLowerCase();
      }

      if (sortOrder === 'asc') {
        return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;
      } else {
        return aValue > bValue ? -1 : aValue < bValue ? 1 : 0;
      }
    });

    setFilteredAssets(filtered);
  }, [assets, searchTerm, filterCategory, filterStatus, sortBy, sortOrder]);

  const handleSort = (field: string) => {
    if (sortBy === field) {
      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');
    } else {
      setSortBy(field);
      setSortOrder('asc');
    }
  };

  // Fonctions de gestion des actions
  const handleNewAsset = () => {
    handleOpenNewAssetModal();
  };

  const handleNewAssetOld = () => {
    setNewAssetForm({
      asset_number: '',
      description: '',
      asset_class: '',
      asset_category: '',
      asset_identification: '',
      uom_group: '',
      capital_appropriation_number: '',
      location: '',
      technician: '',
      employee: '',
      capitalization_date: '',
      acquisition_date: '',
      warranty_end: '',
      acquisition_cost: 0,
      historical_apc: 0,
      net_book_value: 0,
      historical_nbc: 0,
      ordinary_depreciation: 0,
      unplanned_depreciation: 0,
      special_depreciation: 0,
      write_up: 0,
      salvage_value: 0,
      asset_group: '',
      depreciation_group: '',
      depreciation_method: '',
      serial_number: '',
      quantity: 1,
      supplier: '',
      department: '',
      notes: '',
      // Legacy fields
      code: '',
      designation: '',
      category: '',
      subcategory: '',
      acquisition_value: 0,
      responsible: ''
    });
    setActiveFormTab('general');
    setShowNewAssetModal(true);
  };

  const handleEditAsset = (asset: Asset) => {
    setAssetToEdit(asset);
    setNewAssetForm({
      asset_number: asset.asset_number,
      description: asset.description,
      asset_class: asset.asset_class,
      asset_category: asset.asset_category,
      asset_identification: asset.asset_identification,
      uom_group: asset.uom_group,
      capital_appropriation_number: asset.capital_appropriation_number,
      location: asset.location,
      technician: asset.technician,
      employee: asset.employee,
      capitalization_date: asset.capitalization_date,
      acquisition_date: asset.acquisition_date,
      warranty_end: asset.warranty_end,
      acquisition_cost: asset.acquisition_cost,
      historical_apc: asset.historical_apc,
      net_book_value: asset.net_book_value,
      historical_nbc: asset.historical_nbc,
      ordinary_depreciation: asset.ordinary_depreciation,
      unplanned_depreciation: asset.unplanned_depreciation,
      special_depreciation: asset.special_depreciation,
      write_up: asset.write_up,
      salvage_value: asset.salvage_value,
      asset_group: asset.asset_group,
      depreciation_group: asset.depreciation_group,
      depreciation_method: asset.depreciation_method,
      serial_number: asset.serial_number,
      quantity: asset.quantity,
      supplier: asset.supplier,
      department: asset.department,
      notes: asset.notes,
      // Legacy fields
      code: asset.code,
      designation: asset.designation,
      category: asset.category,
      subcategory: asset.subcategory,
      acquisition_value: asset.acquisition_value,
      responsible: asset.responsible
    });
    setActiveFormTab('general');
    setShowEditAssetModal(true);
  };

  const handleDeleteAsset = (asset: Asset) => {
    setAssetToDelete(asset);
    setShowDeleteConfirmModal(true);
  };

  const confirmDeleteAsset = () => {
    if (assetToDelete) {
      setAssets(assets.filter(a => a.id !== assetToDelete.id));
      setShowDeleteConfirmModal(false);
      setAssetToDelete(null);
    }
  };

  const handleSaveAsset = () => {
    if (assetToEdit) {
      // Mode édition
      const updatedAssets = assets.map(asset =>
        asset.id === assetToEdit.id
          ? {
              ...asset,
              ...newAssetForm,
              current_value: newAssetForm.acquisition_value * 0.8, // Calcul simplifié
              net_value: newAssetForm.acquisition_value * 0.8,
              cumulated_depreciation: newAssetForm.acquisition_value * 0.2,
              depreciation_rate: 20,
              status: asset.status
            }
          : asset
      );
      setAssets(updatedAssets);
      setShowEditAssetModal(false);
      setAssetToEdit(null);
    } else {
      // Mode création
      const newAsset: Asset = {
        id: (assets.length + 1).toString(),
        ...newAssetForm,
        current_value: newAssetForm.acquisition_value * 0.8,
        net_value: newAssetForm.acquisition_value * 0.8,
        cumulated_depreciation: newAssetForm.acquisition_value * 0.2,
        depreciation_rate: 20,
        status: 'active' as const,
        last_inventory: new Date().toISOString().split('T')[0]
      };
      setAssets([...assets, newAsset]);
      setShowNewAssetModal(false);
    }
  };

  const handleImport = () => {
    setShowImportModal(true);
  };

  const handleExport = () => {
    setShowExportModal(true);
  };

  const handleQrScanner = () => {
    setShowQrScannerModal(true);
  };

  const exportToCSV = () => {
    const headers = ['Code', 'Désignation', 'Catégorie', 'Valeur Acquisition', 'Valeur Nette', 'Statut', 'Responsable'];
    const csvContent = [
      headers.join(','),
      ...filteredAssets.map(asset => [
        asset.code,
        asset.designation,
        asset.category,
        asset.acquisition_value,
        asset.net_value,
        getStatusLabel(asset.status),
        asset.responsible
      ].join(','))
    ].join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'registre_immobilisations.csv';
    a.click();
    setShowExportModal(false);
  };

  const exportToPDF = () => {
    // Simulation d'export PDF
    console.log('Export PDF des immobilisations');
    setShowExportModal(false);
  };

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('fr-FR', {
      style: 'currency',
      currency: 'XOF',
      minimumFractionDigits: 0
    }).format(amount);
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'active': return 'text-green-600 bg-green-100';
      case 'inactive': return 'text-gray-600 bg-gray-100';
      case 'maintenance': return 'text-orange-600 bg-orange-100';
      case 'disposed': return 'text-red-600 bg-red-100';
      default: return 'text-gray-600 bg-gray-100';
    }
  };

  const getStatusLabel = (status: string) => {
    switch (status) {
      case 'active': return 'Actif';
      case 'inactive': return 'Inactif';
      case 'maintenance': return 'Maintenance';
      case 'disposed': return 'Cédé';
      default: return 'Inconnu';
    }
  };

  const totalAssets = assets.length;
  const totalValue = assets.reduce((sum, asset) => sum + asset.net_value, 0);
  const activeAssets = assets.filter(a => a.status === 'active').length;
  const maintenanceAssets = assets.filter(a => a.status === 'maintenance').length;

  const renderModuleContent = () => {
    switch (activeModule) {
      case 1: // Synthèse
        return (
          <div className="space-y-6">
            {/* Statistics Cards */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <StatCard
                title="Total Actifs"
                value={totalAssets.toString()}
                icon={Package}
                trend={{ value: 12, isPositive: true }}
                className="bg-blue-50 border-blue-200"
              />
              <StatCard
                title="Valeur Totale"
                value={formatCurrency(totalValue)}
                icon={DollarSign}
                trend={{ value: 8, isPositive: true }}
                className="bg-green-50 border-green-200"
              />
              <StatCard
                title="Actifs Actifs"
                value={activeAssets.toString()}
                icon={CheckCircle}
                trend={{ value: 5, isPositive: true }}
                className="bg-emerald-50 border-emerald-200"
              />
              <StatCard
                title="En Maintenance"
                value={maintenanceAssets.toString()}
                icon={Wrench}
                trend={{ value: 2, isPositive: false }}
                className="bg-orange-50 border-orange-200"
              />
            </div>

            {/* Quick Actions */}
            <ModernCard>
              <CardHeader>
                <h3 className="text-lg font-semibold">Actions Rapides</h3>
              </CardHeader>
              <CardBody>
                <div className="flex flex-wrap gap-3">
                  <ModernButton variant="primary" size="sm" onClick={handleNewAsset}>
                    <Plus className="w-4 h-4 mr-1" />
                    Nouvel Actif
                  </ModernButton>
                  <ModernButton variant="outline" size="sm" onClick={handleImport}>
                    <Upload className="w-4 h-4 mr-1" />
                    Import Excel
                  </ModernButton>
                  <ModernButton variant="outline" size="sm" onClick={handleExport}>
                    <Download className="w-4 h-4 mr-1" />
                    Export Registre
                  </ModernButton>
                  <ModernButton variant="outline" size="sm" onClick={handleQrScanner}>
                    <QrCode className="w-4 h-4 mr-1" />
                    Scanner QR
                  </ModernButton>
                </div>
              </CardBody>
            </ModernCard>

            {/* Recent Activities */}
            <ModernCard>
              <CardHeader>
                <h3 className="text-lg font-semibold">Activités Récentes</h3>
              </CardHeader>
              <CardBody>
                <div className="space-y-3">
                  {[
                    { action: 'Nouvel actif ajouté', asset: 'Serveur Dell PowerEdge', time: '2h', icon: Plus, color: 'text-green-600' },
                    { action: 'Maintenance programmée', asset: 'Toyota Hilux', time: '4h', icon: Wrench, color: 'text-orange-600' },
                    { action: 'Inventaire mis à jour', asset: 'Bâtiment Siège', time: '1j', icon: Activity, color: 'text-blue-600' }
                  ].map((activity, index) => (
                    <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div className="flex items-center space-x-3">
                        <activity.icon className={`w-5 h-5 ${activity.color}`} />
                        <div>
                          <p className="font-medium">{activity.action}</p>
                          <p className="text-sm text-gray-600">{activity.asset}</p>
                        </div>
                      </div>
                      <span className="text-sm text-gray-500">{activity.time}</span>
                    </div>
                  ))}
                </div>
              </CardBody>
            </ModernCard>
          </div>
        );

      case 2: // Registre Central
        return (
          <div className="space-y-6">
            {/* Filters and Search */}
            <ModernCard>
              <CardBody>
                <div className="flex flex-col md:flex-row gap-4">
                  <div className="flex-1">
                    <div className="relative">
                      <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
                      <input
                        type="text"
                        placeholder="Rechercher par désignation, code ou responsable..."
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                    </div>
                  </div>
                  <div className="flex gap-2">
                    <select
                      value={filterCategory}
                      onChange={(e) => setFilterCategory(e.target.value)}
                      className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="all">Toutes catégories</option>
                      <option value="Immobilier">Immobilier</option>
                      <option value="Informatique">Informatique</option>
                      <option value="Véhicules">Véhicules</option>
                      <option value="Mobilier">Mobilier</option>
                    </select>
                    <select
                      value={filterStatus}
                      onChange={(e) => setFilterStatus(e.target.value)}
                      className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="all">Tous statuts</option>
                      <option value="active">Actif</option>
                      <option value="inactive">Inactif</option>
                      <option value="maintenance">Maintenance</option>
                      <option value="disposed">Cédé</option>
                    </select>
                    <ModernButton
                      variant="outline"
                      size="sm"
                      onClick={() => setViewMode(viewMode === 'table' ? 'cards' : 'table')}
                    >
                      {viewMode === 'table' ? <Package /> : <BarChart3 />}
                    </ModernButton>
                  </div>
                </div>
              </CardBody>
            </ModernCard>

            {/* Assets Table */}
            <ModernCard>
              <CardHeader>
                <div className="flex items-center justify-between">
                  <h3 className="text-lg font-semibold">
                    Registre des Immobilisations ({filteredAssets.length})
                  </h3>
                  <div className="flex gap-2">
                    <ModernButton variant="primary" size="sm" onClick={handleNewAsset}>
                      <Plus className="w-4 h-4 mr-1" />
                      Nouvel Actif
                    </ModernButton>
                    <ModernButton variant="outline" size="sm" onClick={handleExport}>
                      <Download className="w-4 h-4 mr-1" />
                      Export
                    </ModernButton>
                  </div>
                </div>
              </CardHeader>
              <CardBody>
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead>
                      <tr className="border-b border-gray-200">
                        <th
                          className="text-left py-3 px-4 cursor-pointer hover:bg-gray-50"
                          onClick={() => handleSort('code')}
                        >
                          Code
                        </th>
                        <th
                          className="text-left py-3 px-4 cursor-pointer hover:bg-gray-50"
                          onClick={() => handleSort('designation')}
                        >
                          Désignation
                        </th>
                        <th
                          className="text-left py-3 px-4 cursor-pointer hover:bg-gray-50"
                          onClick={() => handleSort('category')}
                        >
                          Catégorie
                        </th>
                        <th
                          className="text-left py-3 px-4 cursor-pointer hover:bg-gray-50"
                          onClick={() => handleSort('acquisition_value')}
                        >
                          Valeur d'Acquisition
                        </th>
                        <th
                          className="text-left py-3 px-4 cursor-pointer hover:bg-gray-50"
                          onClick={() => handleSort('net_value')}
                        >
                          Valeur Nette
                        </th>
                        <th
                          className="text-left py-3 px-4 cursor-pointer hover:bg-gray-50"
                          onClick={() => handleSort('status')}
                        >
                          Statut
                        </th>
                        <th
                          className="text-left py-3 px-4 cursor-pointer hover:bg-gray-50"
                          onClick={() => handleSort('responsible')}
                        >
                          Responsable
                        </th>
                        <th className="text-left py-3 px-4">Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {filteredAssets.map((asset) => (
                        <tr key={asset.id} className="border-b border-gray-100 hover:bg-gray-50">
                          <td className="py-3 px-4 font-medium">{asset.code}</td>
                          <td className="py-3 px-4">{asset.designation}</td>
                          <td className="py-3 px-4">
                            <span className="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">
                              {asset.category}
                            </span>
                          </td>
                          <td className="py-3 px-4">{formatCurrency(asset.acquisition_value)}</td>
                          <td className="py-3 px-4 font-medium">{formatCurrency(asset.net_value)}</td>
                          <td className="py-3 px-4">
                            <span className={`px-2 py-1 rounded-full text-xs ${getStatusColor(asset.status)}`}>
                              {getStatusLabel(asset.status)}
                            </span>
                          </td>
                          <td className="py-3 px-4">{asset.responsible}</td>
                          <td className="py-3 px-4">
                            <div className="flex gap-1">
                              <button
                                onClick={() => {
                                  setSelectedAsset(asset);
                                  setShowAssetModal(true);
                                }}
                                className="p-1 text-blue-600 hover:bg-blue-100 rounded"
                                title="Voir les détails"
                              >
                                <Eye className="w-4 h-4" />
                              </button>
                              <button
                                onClick={() => handleEditAsset(asset)}
                                className="p-1 text-orange-600 hover:bg-orange-100 rounded"
                                title="Modifier"
                              >
                                <Edit className="w-4 h-4" />
                              </button>
                              <button
                                onClick={() => handleDeleteAsset(asset)}
                                className="p-1 text-red-600 hover:bg-red-100 rounded"
                                title="Supprimer"
                              >
                                <Trash2 className="w-4 h-4" />
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </CardBody>
            </ModernCard>
          </div>
        );

      default:
        return (
          <div className="text-center py-12">
            <Package className="w-16 h-16 text-gray-400 mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-gray-900 mb-2">Module en développement</h3>
            <p className="text-gray-600">Ce module sera bientôt disponible.</p>
          </div>
        );
    }
  };

  return (
    <div className="space-y-6">
      {renderModuleContent()}

      {/* Asset Detail Modal */}
      {showAssetModal && selectedAsset && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6 border-b border-gray-200">
              <div className="flex items-center justify-between">
                <h2 className="text-xl font-bold">{selectedAsset.designation}</h2>
                <button
                  onClick={() => setShowAssetModal(false)}
                  className="text-gray-400 hover:text-gray-600"
                >
                  <X className="w-6 h-6" />
                </button>
              </div>
            </div>
            <div className="p-6 space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <h3 className="font-semibold mb-3">Informations Générales</h3>
                  <div className="space-y-2 text-sm">
                    <div><span className="font-medium">Code:</span> {selectedAsset.code}</div>
                    <div><span className="font-medium">Catégorie:</span> {selectedAsset.category}</div>
                    <div><span className="font-medium">Localisation:</span> {selectedAsset.location}</div>
                    <div><span className="font-medium">Responsable:</span> {selectedAsset.responsible}</div>
                  </div>
                </div>
                <div>
                  <h3 className="font-semibold mb-3">Informations Financières</h3>
                  <div className="space-y-2 text-sm">
                    <div><span className="font-medium">Valeur d'acquisition:</span> {formatCurrency(selectedAsset.acquisition_value)}</div>
                    <div><span className="font-medium">Amortissement cumulé:</span> {formatCurrency(selectedAsset.cumulated_depreciation)}</div>
                    <div><span className="font-medium">Valeur nette:</span> {formatCurrency(selectedAsset.net_value)}</div>
                    <div><span className="font-medium">Taux d'amortissement:</span> {selectedAsset.depreciation_rate}%</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* New Asset Modal */}
      {showNewAssetModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-7xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6 border-b border-gray-200">
              <div className="flex items-center justify-between">
                <h2 className="text-xl font-bold">Asset Master Data - Nouvel Actif</h2>
                <button
                  onClick={() => setShowNewAssetModal(false)}
                  className="text-gray-400 hover:text-gray-600"
                >
                  <X className="w-6 h-6" />
                </button>
              </div>
            </div>

            {/* Header with Photo and Asset Info */}
            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200 p-6">
              <div className="flex items-start space-x-6">
                {/* Photo Section */}
                <div className="flex-shrink-0">
                  <div className="w-32 h-32 bg-white border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center group hover:border-blue-400 transition-colors cursor-pointer">
                    {newAssetForm.asset_photo ? (
                      <img
                        src={newAssetForm.asset_photo}
                        alt="Asset"
                        className="w-full h-full object-cover rounded-lg"
                      />
                    ) : (
                      <div className="text-center">
                        <Camera className="w-8 h-8 text-gray-400 mx-auto mb-2 group-hover:text-blue-500" />
                        <p className="text-xs text-gray-500 group-hover:text-blue-600">Ajouter photo</p>
                      </div>
                    )}
                  </div>
                </div>

                {/* Asset Information Grid */}
                <div className="flex-1">
                  <div className="grid grid-cols-3 lg:grid-cols-5 gap-x-4 gap-y-3">
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Capital Appropriation Request Number</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {newAssetForm.capital_appropriation_number || 'CAR-2024-001'}
                      </p>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Asset Number</label>
                      <p className="text-sm font-semibold text-blue-600 mt-0.5">
                        {newAssetForm.asset_number || '235377'}
                      </p>
                    </div>
                    <div className="lg:col-span-3 flex items-start gap-4">
                      <div className="flex-1">
                        <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Description</label>
                        <p className="text-sm font-semibold text-gray-900 mt-0.5 leading-tight">
                          {newAssetForm.description || 'ARIC TRAVAUX D\'ASSAINISSEMENT'}
                        </p>
                      </div>
                      <div className="flex items-center">
                        <div className="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                        <div>
                          <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Status</label>
                          <p className="text-sm font-semibold text-green-700">En service</p>
                        </div>
                      </div>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">UoM Group</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {newAssetForm.uom_group || 'Unité'}
                      </p>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Asset Class</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {newAssetForm.asset_class || '24 - matériel, mobilier'}
                      </p>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Asset Category</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {newAssetForm.asset_category || 'Matériel technique'}
                      </p>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Asset Identification</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {newAssetForm.asset_identification || 'ID-00333'}
                      </p>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Emplacement</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {newAssetForm.location || 'EMPLACEMENT'}
                      </p>
                    </div>
                  </div>
                </div>

                {/* QR Code Section */}
                <div className="flex-shrink-0">
                  <div className="bg-white border border-gray-300 rounded-lg p-3 text-center shadow-sm">
                    <div className="w-16 h-16 bg-gray-100 border border-gray-200 rounded flex items-center justify-center mx-auto mb-2">
                      <div className="grid grid-cols-4 gap-0.5 w-10 h-10">
                        {[...Array(16)].map((_, i) => (
                          <div key={i} className={`w-1.5 h-1.5 ${
                            Math.random() > 0.5 ? 'bg-gray-800' : 'bg-transparent'
                          } rounded-sm`} />
                        ))}
                      </div>
                    </div>
                    <p className="text-xs font-medium text-gray-700">QR Code</p>
                    <p className="text-xs text-gray-500 mt-1">{newAssetForm.asset_number || '235377'}</p>
                    <button className="mt-1 text-xs text-blue-600 hover:text-blue-800 font-medium">
                      Générer
                    </button>
                  </div>
                </div>
              </div>
            </div>

            {/* Layout avec Sidebar */}
            <div className="flex h-[60vh]">
              {/* Sidebar Navigation */}
              <div className="w-64 bg-gray-50 border-r border-gray-200 overflow-y-auto">
                <nav className="p-4 space-y-2">
                  {[
                    { id: 'general', label: 'Information générale', icon: Info },
                    { id: 'acquisition', label: 'Informations acquisition', icon: DollarSign },
                    { id: 'immobilisation', label: 'Immobilisation', icon: Building },
                    { id: 'vente', label: 'Données de vente', icon: TrendingDown },
                    { id: 'composants', label: 'Composants', icon: Package },
                    { id: 'maintenance', label: 'Données de maintenance', icon: Wrench },
                    { id: 'attachements', label: 'Attachements', icon: FileText },
                    { id: 'notes', label: 'Notes', icon: Edit }
                  ].map((section) => {
                    const IconComponent = section.icon;
                    return (
                      <button
                        key={section.id}
                        onClick={() => setActiveFormTab(section.id)}
                        className={`w-full flex items-center px-3 py-2 text-left rounded-lg transition-colors ${
                          activeFormTab === section.id
                            ? 'bg-blue-100 text-blue-700 font-medium'
                            : 'text-gray-700 hover:bg-gray-100'
                        }`}
                      >
                        <IconComponent className="w-4 h-4 mr-3" />
                        <span className="text-sm">{section.label}</span>
                      </button>
                    );
                  })}
                </nav>
              </div>

              {/* Content Area */}
              <div className="flex-1 overflow-y-auto p-6">
              {/* Onglet General Information */}
              {activeFormTab === 'general' && (
                <div className="space-y-6">
                  {/* Horizontal Tabs for General Information */}
                  <div className="border-b border-gray-200">
                    <nav className="flex space-x-8">
                      {[
                        { id: 'basic', label: 'Actif Info', icon: Info },
                        { id: 'material', label: 'Material Data', icon: Package },
                        { id: 'warranty', label: 'Warranty', icon: Shield },
                        { id: 'insurance', label: 'Insurance', icon: FileText },
                        { id: 'location', label: 'Location', icon: MapPin }
                      ].map((tab) => {
                        const IconComponent = tab.icon;
                        return (
                          <button
                            key={tab.id}
                            onClick={() => setActiveGeneralTab(tab.id)}
                            className={`flex items-center py-2 px-1 border-b-2 font-medium text-sm transition-colors ${
                              activeGeneralTab === tab.id
                                ? 'border-blue-500 text-blue-600'
                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                            }`}
                          >
                            <IconComponent className="w-4 h-4 mr-2" />
                            {tab.label}
                          </button>
                        );
                      })}
                    </nav>
                  </div>

                  {/* Tab Content */}
                  <div className="mt-6">
                    {/* Basic Info Tab */}
                    {activeGeneralTab === 'basic' && (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  <div>
                    <label className="block text-sm font-medium mb-1">Asset Number *</label>
                    <input
                      type="text"
                      value={newAssetForm.asset_number}
                      onChange={(e) => setNewAssetForm({...newAssetForm, asset_number: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Ex: 235377"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Description *</label>
                    <input
                      type="text"
                      value={newAssetForm.description}
                      onChange={(e) => setNewAssetForm({...newAssetForm, description: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Ex: ARIC TRAVAUX D'ASSAINISSEMENT"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1 flex items-center gap-2">
                      Asset Class *
                      {capitationData && (
                        <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full flex items-center gap-1">
                          <Brain className="w-3 h-3" />
                          Auto-rempli
                        </span>
                      )}
                    </label>
                    <select
                      value={newAssetForm.asset_class}
                      onChange={(e) => setNewAssetForm({...newAssetForm, asset_class: e.target.value})}
                      className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${
                        capitationData?.asset_class ? 'border-green-300 bg-green-50' : 'border-gray-300'
                      }`}
                      disabled={!!capitationData?.asset_class}
                    >
                      <option value="">-- Select --</option>
                      <option value="21 - équipement informatique">21 - équipement informatique</option>
                      <option value="22 - équipement médical">22 - équipement médical</option>
                      <option value="23 - véhicules">23 - véhicules</option>
                      <option value="24 - matériel, mobilier">24 - matériel, mobilier</option>
                      <option value="25 - immobilisations incorporelles">25 - immobilisations incorporelles</option>
                    </select>
                    {capitationData?.asset_class && (
                      <p className="text-xs text-green-600 mt-1">
                        Récupéré automatiquement du formulaire de capitation
                      </p>
                    )}
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Asset Category</label>
                    <input
                      type="text"
                      value={newAssetForm.asset_category}
                      onChange={(e) => setNewAssetForm({...newAssetForm, asset_category: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Ex: Matériel technique"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Asset Identification</label>
                    <input
                      type="text"
                      value={newAssetForm.asset_identification}
                      onChange={(e) => setNewAssetForm({...newAssetForm, asset_identification: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Ex: ID-00333"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">UoM Group</label>
                    <input
                      type="text"
                      value={newAssetForm.uom_group}
                      onChange={(e) => setNewAssetForm({...newAssetForm, uom_group: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Ex: Unité"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Serial Number</label>
                    <input
                      type="text"
                      value={newAssetForm.serial_number}
                      onChange={(e) => setNewAssetForm({...newAssetForm, serial_number: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Numéro de série"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Location</label>
                    <input
                      type="text"
                      value={newAssetForm.location}
                      onChange={(e) => setNewAssetForm({...newAssetForm, location: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Emplacement"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1 flex items-center gap-2">
                      Technician
                      {wiseFMData && (
                        <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full flex items-center gap-1">
                          <Wrench className="w-3 h-3" />
                          WiseFM
                        </span>
                      )}
                    </label>
                    <select
                      value={newAssetForm.technician}
                      onChange={(e) => setNewAssetForm({...newAssetForm, technician: e.target.value})}
                      className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${
                        wiseFMData?.technician ? 'border-blue-300 bg-blue-50' : 'border-gray-300'
                      }`}
                      disabled={!!wiseFMData?.technician}
                    >
                      <option value="">Sélectionnez...</option>
                      <option value="Amadou Diallo">Amadou Diallo</option>
                      <option value="Mohamed Kane">Mohamed Kane</option>
                      <option value="Cheikh Diop">Cheikh Diop</option>
                    </select>
                    {wiseFMData?.technician && (
                      <p className="text-xs text-blue-600 mt-1">
                        Assigné automatiquement via contrat WiseFM
                      </p>
                    )}
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Employee</label>
                    <select
                      value={newAssetForm.employee}
                      onChange={(e) => setNewAssetForm({...newAssetForm, employee: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="">Sélectionnez...</option>
                      <option value="Fatima Ndiaye">Fatima Ndiaye</option>
                      <option value="Moussa Seck">Moussa Seck</option>
                      <option value="Aminata Fall">Aminata Fall</option>
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Quantity</label>
                    <input
                      type="number"
                      value={newAssetForm.quantity}
                      onChange={(e) => setNewAssetForm({...newAssetForm, quantity: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      min="1"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1 flex items-center gap-2">
                      Capital Appropriation Request Number
                      {capitationData && (
                        <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full flex items-center gap-1">
                          <Brain className="w-3 h-3" />
                          Auto-rempli
                        </span>
                      )}
                    </label>
                    <input
                      type="text"
                      value={newAssetForm.capital_appropriation_number}
                      onChange={(e) => setNewAssetForm({...newAssetForm, capital_appropriation_number: e.target.value})}
                      className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${
                        capitationData?.capital_appropriation_number ? 'border-green-300 bg-green-50' : 'border-gray-300'
                      }`}
                      placeholder="Ex: CAR-2024-001"
                      readOnly={!!capitationData?.capital_appropriation_number}
                    />
                    {capitationData?.capital_appropriation_number && (
                      <p className="text-xs text-green-600 mt-1">
                        Récupéré automatiquement du formulaire de capitation
                      </p>
                    )}
                  </div>
                      </div>
                    )}

                    {/* Material Data Tab */}
                    {activeGeneralTab === 'material' && (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                          <label className="block text-sm font-medium mb-1">Additional Identifier</label>
                          <input
                            type="text"
                            value={newAssetForm.additional_identifier || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, additional_identifier: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Identifiant supplémentaire"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Shipping Type</label>
                          <select
                            value={newAssetForm.shipping_type || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, shipping_type: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Sélectionnez...</option>
                            <option value="standard">Standard</option>
                            <option value="express">Express</option>
                            <option value="overnight">Overnight</option>
                            <option value="freight">Freight</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Serial & Batch Numbers</label>
                          <input
                            type="text"
                            value={newAssetForm.serial_batch_numbers || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, serial_batch_numbers: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Numéros de série et de lot"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Managed Items By</label>
                          <input
                            type="text"
                            value={newAssetForm.managed_items_by || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, managed_items_by: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Géré par"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Disposal Method</label>
                          <select
                            value={newAssetForm.disposal_method || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, disposal_method: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Sélectionnez...</option>
                            <option value="sale">Vente</option>
                            <option value="donation">Don</option>
                            <option value="recycling">Recyclage</option>
                            <option value="destruction">Destruction</option>
                          </select>
                        </div>
                      </div>
                    )}

                    {/* Warranty Tab */}
                    {activeGeneralTab === 'warranty' && (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                          <label className="block text-sm font-medium mb-1">Warranty Period</label>
                          <input
                            type="text"
                            value={newAssetForm.warranty_period || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, warranty_period: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Ex: 24 mois"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Warranty End Date</label>
                          <input
                            type="date"
                            value={newAssetForm.warranty_end}
                            onChange={(e) => setNewAssetForm({...newAssetForm, warranty_end: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                        <div className="md:col-span-2 lg:col-span-3">
                          <label className="block text-sm font-medium mb-1">Terms and Conditions</label>
                          <textarea
                            value={newAssetForm.warranty_terms || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, warranty_terms: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            rows={4}
                            placeholder="Conditions de garantie..."
                          />
                        </div>
                      </div>
                    )}

                    {/* Insurance Tab */}
                    {activeGeneralTab === 'insurance' && (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                          <label className="block text-sm font-medium mb-1">Insurance Provider</label>
                          <input
                            type="text"
                            value={newAssetForm.insurance_provider || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, insurance_provider: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Nom de l'assureur"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Policy Details</label>
                          <input
                            type="text"
                            value={newAssetForm.policy_details || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, policy_details: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Numéro de police"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Coverage Amount (XOF)</label>
                          <input
                            type="number"
                            value={newAssetForm.coverage_amount || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, coverage_amount: Number(e.target.value)})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Montant de couverture"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Expiration Date</label>
                          <input
                            type="date"
                            value={newAssetForm.insurance_expiration || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, insurance_expiration: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                      </div>
                    )}

                    {/* Location Tab */}
                    {activeGeneralTab === 'location' && (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                          <label className="block text-sm font-medium mb-1">Building/Location Name</label>
                          <input
                            type="text"
                            value={newAssetForm.building_name || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, building_name: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Nom du bâtiment"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Floor</label>
                          <input
                            type="text"
                            value={newAssetForm.floor || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, floor: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Étage"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Zoning</label>
                          <input
                            type="text"
                            value={newAssetForm.zoning || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, zoning: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Zone"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Unit</label>
                          <select
                            value={newAssetForm.unit || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, unit: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Sélectionnez...</option>
                            <option value="A">Unité A</option>
                            <option value="B">Unité B</option>
                            <option value="C">Unité C</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Room</label>
                          <select
                            value={newAssetForm.room || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, room: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Sélectionnez...</option>
                            <option value="101">Salle 101</option>
                            <option value="102">Salle 102</option>
                            <option value="201">Salle 201</option>
                            <option value="202">Salle 202</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">GPS Coordinates</label>
                          <input
                            type="text"
                            value={newAssetForm.gps_coordinates || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, gps_coordinates: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Ex: 14.6928,-17.4467"
                          />
                        </div>
                      </div>
                    )}

                    {/* Changes Tracking Tab */}
                    {activeImmobilisationTab === 'changes-tracking' && (
                      <div className="space-y-6">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <div>
                            <label className="block text-sm font-medium mb-1">Last Change Date</label>
                            <input
                              type="date"
                              value={newAssetForm.last_change_date || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, last_change_date: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Change Reason</label>
                            <select
                              value={newAssetForm.change_reason || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, change_reason: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="">-- Raison du changement --</option>
                              <option value="transfer">Transfert</option>
                              <option value="revaluation">Réévaluation</option>
                              <option value="impairment">Dépréciation</option>
                              <option value="upgrade">Amélioration</option>
                              <option value="correction">Correction</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Changed By</label>
                            <input
                              type="text"
                              value={newAssetForm.changed_by || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, changed_by: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Utilisateur ayant effectué le changement"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Reference Document</label>
                            <input
                              type="text"
                              value={newAssetForm.reference_document || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, reference_document: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Document de référence"
                            />
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Change Description</label>
                          <textarea
                            value={newAssetForm.change_description || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, change_description: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            rows={4}
                            placeholder="Description détaillée des modifications apportées..."
                          />
                        </div>

                        {/* Changes History Table */}
                        <div className="mt-8">
                          <h4 className="text-lg font-medium mb-4">Historique des modifications</h4>
                          <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                              <thead className="bg-gray-50">
                                <tr>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date du<br/>changement</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Numéro<br/>de l'actif</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Description<br/>de l'actif</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Type de<br/>changement</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ancienne<br/>valeur</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nouvelle<br/>valeur</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ancien<br/>centre de coût</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nouveau<br/>centre de coût</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ancienne<br/>méthode de<br/>dépréciation</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nouvelle<br/>méthode de<br/>dépréciation</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ancienne<br/>durée de vie<br/>estimée</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nouvelle<br/>durée de vie<br/>estimée</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ancienne<br/>Valeur<br/>résiduelle</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nouvelle<br/>Valeur<br/>résiduelle</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Responsable<br/>du changement</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Commentaires</th>
                                </tr>
                              </thead>
                              <tbody className="bg-white divide-y divide-gray-200">
                                <tr>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">20/08/2024</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">12345</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Ordinateur portable</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">
                                    <span className="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">Réévaluation</span>
                                  </td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Centre A</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Centre B</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Linéaire</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Dégressif</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">5 ans</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">4 ans</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Pamela Atokouna</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">
                                    <button className="text-gray-400 hover:text-gray-600">
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01" />
                                      </svg>
                                    </button>
                                  </td>
                                </tr>
                                <tr>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">20/08/2024</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">12345</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Ordinateur portable</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">
                                    <span className="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">Réévaluation</span>
                                  </td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Centre A</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Centre B</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Linéaire</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Dégressif</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">5 ans</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">4 ans</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Pamela Atokouna</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">
                                    <button className="text-gray-400 hover:text-gray-600">
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01" />
                                      </svg>
                                    </button>
                                  </td>
                                </tr>
                                <tr>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">20/08/2024</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">12345</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Ordinateur portable</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">
                                    <span className="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">Réévaluation</span>
                                  </td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Centre A</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Centre B</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Linéaire</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Dégressif</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">5 ans</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">4 ans</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Pamela Atokouna</td>
                                  <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">
                                    <button className="text-gray-400 hover:text-gray-600">
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01" />
                                      </svg>
                                    </button>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Onglet Acquisition Information */}
              {activeFormTab === 'acquisition' && (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label className="block text-sm font-medium mb-1">Capitalization Date</label>
                    <input
                      type="date"
                      value={newAssetForm.capitalization_date}
                      onChange={(e) => setNewAssetForm({...newAssetForm, capitalization_date: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Acquisition Date</label>
                    <input
                      type="date"
                      value={newAssetForm.acquisition_date}
                      onChange={(e) => setNewAssetForm({...newAssetForm, acquisition_date: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Acquisition Cost (XOF)</label>
                    <input
                      type="number"
                      value={newAssetForm.acquisition_cost}
                      onChange={(e) => setNewAssetForm({...newAssetForm, acquisition_cost: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="0"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Supplier</label>
                    <input
                      type="text"
                      value={newAssetForm.supplier}
                      onChange={(e) => setNewAssetForm({...newAssetForm, supplier: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Nom du fournisseur"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Warranty End Date</label>
                    <input
                      type="date"
                      value={newAssetForm.warranty_end}
                      onChange={(e) => setNewAssetForm({...newAssetForm, warranty_end: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Department</label>
                    <input
                      type="text"
                      value={newAssetForm.department}
                      onChange={(e) => setNewAssetForm({...newAssetForm, department: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Département d'affectation"
                    />
                  </div>
                </div>
              )}

              {/* Onglet Values */}
              {activeFormTab === 'values' && (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label className="block text-sm font-medium mb-1">Historical APC (Acc. Prov. for Dep.)</label>
                    <input
                      type="number"
                      value={newAssetForm.historical_apc}
                      onChange={(e) => setNewAssetForm({...newAssetForm, historical_apc: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Net Book Value</label>
                    <input
                      type="number"
                      value={newAssetForm.net_book_value}
                      onChange={(e) => setNewAssetForm({...newAssetForm, net_book_value: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Historical NBC (Net Book Cost)</label>
                    <input
                      type="number"
                      value={newAssetForm.historical_nbc}
                      onChange={(e) => setNewAssetForm({...newAssetForm, historical_nbc: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Ordinary Depreciation</label>
                    <input
                      type="number"
                      value={newAssetForm.ordinary_depreciation}
                      onChange={(e) => setNewAssetForm({...newAssetForm, ordinary_depreciation: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Unplanned Depreciation</label>
                    <input
                      type="number"
                      value={newAssetForm.unplanned_depreciation}
                      onChange={(e) => setNewAssetForm({...newAssetForm, unplanned_depreciation: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Special Depreciation</label>
                    <input
                      type="number"
                      value={newAssetForm.special_depreciation}
                      onChange={(e) => setNewAssetForm({...newAssetForm, special_depreciation: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Write-up</label>
                    <input
                      type="number"
                      value={newAssetForm.write_up}
                      onChange={(e) => setNewAssetForm({...newAssetForm, write_up: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Salvage Value</label>
                    <input
                      type="number"
                      value={newAssetForm.salvage_value}
                      onChange={(e) => setNewAssetForm({...newAssetForm, salvage_value: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                </div>
              )}

              {/* Onglet Depreciation Parameters */}
              {activeFormTab === 'depreciation' && (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label className="block text-sm font-medium mb-1">Asset Group</label>
                    <input
                      type="text"
                      value={newAssetForm.asset_group}
                      onChange={(e) => setNewAssetForm({...newAssetForm, asset_group: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Ex: IMMOBILIER"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Depreciation Group</label>
                    <input
                      type="text"
                      value={newAssetForm.depreciation_group}
                      onChange={(e) => setNewAssetForm({...newAssetForm, depreciation_group: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Ex: DEP-IMMO"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Depreciation Method</label>
                    <select
                      value={newAssetForm.depreciation_method}
                      onChange={(e) => setNewAssetForm({...newAssetForm, depreciation_method: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="">-- Select --</option>
                      <option value="Linéaire">Linéaire</option>
                      <option value="Dégressif">Dégressif</option>
                      <option value="Variable">Variable</option>
                      <option value="Unités de production">Unités de production</option>
                    </select>
                  </div>
                </div>
              )}

              {/* Section Immobilisation */}
              {activeFormTab === 'immobilisation' && (
                <div className="flex flex-col h-full">
                  {/* Horizontal Tabs for Immobilisation - Fixed Header */}
                  <div className="border-b border-gray-200 sticky top-0 bg-white z-10">
                    <nav className="flex space-x-8 overflow-x-auto">
                      {[
                        { id: 'overview', label: 'Overview', icon: Eye },
                        { id: 'values', label: 'Values', icon: DollarSign },
                        { id: 'depreciation-params', label: 'Depreciation parameters', icon: TrendingDown },
                        { id: 'depreciation-table', label: 'Depreciation table', icon: BarChart3 },
                        { id: 'cost-accounting', label: 'Cost accounting', icon: Calculator },
                        { id: 'changes-tracking', label: 'Changes tracking', icon: Activity }
                      ].map((tab) => {
                        const IconComponent = tab.icon;
                        return (
                          <button
                            key={tab.id}
                            onClick={() => setActiveImmobilisationTab(tab.id)}
                            className={`flex items-center py-2 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${
                              activeImmobilisationTab === tab.id
                                ? 'border-blue-500 text-blue-600'
                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                            }`}
                          >
                            <IconComponent className="w-4 h-4 mr-2" />
                            {tab.label}
                          </button>
                        );
                      })}
                    </nav>
                  </div>

                  {/* Tab Content - Scrollable */}
                  <div className="flex-1 overflow-y-auto mt-6">
                    {/* Overview Tab */}
                    {activeImmobilisationTab === 'overview' && (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                          <label className="block text-sm font-medium mb-1">Asset Status</label>
                          <select
                            value={newAssetForm.asset_status || 'active'}
                            onChange={(e) => setNewAssetForm({...newAssetForm, asset_status: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="under_construction">Under Construction</option>
                            <option value="retired">Retired</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Useful Life (years)</label>
                          <input
                            type="number"
                            value={newAssetForm.useful_life || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, useful_life: Number(e.target.value)})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Ex: 5"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Remaining Life (years)</label>
                          <input
                            type="number"
                            value={newAssetForm.remaining_life || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, remaining_life: Number(e.target.value)})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Ex: 3"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Capitalization Date</label>
                          <input
                            type="date"
                            value={newAssetForm.capitalization_date}
                            onChange={(e) => setNewAssetForm({...newAssetForm, capitalization_date: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Retirement Date</label>
                          <input
                            type="date"
                            value={newAssetForm.retirement_date || ''}
                            onChange={(e) => setNewAssetForm({...newAssetForm, retirement_date: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Asset Group</label>
                          <input
                            type="text"
                            value={newAssetForm.asset_group}
                            onChange={(e) => setNewAssetForm({...newAssetForm, asset_group: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Ex: IMMOBILIER"
                          />
                        </div>
                      </div>
                    )}

                    {/* Values Tab */}
                    {activeImmobilisationTab === 'values' && (
                      <div className="space-y-6">
                        <div className="bg-green-50 p-4 rounded-lg mb-6">
                          <h3 className="font-medium text-green-800 mb-2">Valeurs de l'immobilisation</h3>
                          <p className="text-sm text-green-600">Valeurs d'acquisition, nettes et d'amortissement</p>
                        </div>

                        {/* Depreciation Area Section */}
                        <div className="space-y-4">
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-medium mb-1">Depreciation Area</label>
                              <select
                                value={newAssetForm.depreciation_area || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, depreciation_area: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              >
                                <option value="">Sélectionnez...</option>
                                <option value="fiscal">Zone fiscale</option>
                                <option value="comptable">Zone comptable</option>
                                <option value="ifrs">Zone IFRS</option>
                                <option value="management">Zone de gestion</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Fiscal Year</label>
                              <select
                                value={newAssetForm.fiscal_year || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, fiscal_year: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              >
                                <option value="">Sélectionnez...</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                              </select>
                            </div>
                          </div>

                          {/* Depreciation Table */}
                          <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                              <thead className="bg-gray-50">
                                <tr>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Transaction</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acquisition and production costs</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Depreciation</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Write-up</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Net Book Value</th>
                                </tr>
                              </thead>
                              <tbody className="bg-white divide-y divide-gray-200">
                                {/* Beginning of year */}
                                <tr className="bg-blue-50">
                                  <td className="px-4 py-3 text-sm font-semibold text-blue-900" colSpan={2}>Beginning of year</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">1,500,000</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">1</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">300,000</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">1,200,000</td>
                                </tr>

                                {/* Transactions */}
                                <tr>
                                  <td className="px-4 py-3 text-sm text-gray-900">1</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">Acquisition</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">250,000</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">1</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">250,000</td>
                                </tr>
                                <tr>
                                  <td className="px-4 py-3 text-sm text-gray-900">2</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">Amortissement annuel</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">175,000</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">-175,000</td>
                                </tr>
                                <tr>
                                  <td className="px-4 py-3 text-sm text-gray-900">3</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">Réévaluation</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">50,000</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">50,000</td>
                                </tr>

                                {/* End of year */}
                                <tr className="bg-green-50">
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900" colSpan={2}>End of year</td>
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900">1,750,000</td>
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900">2</td>
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900">475,000</td>
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900">50,000</td>
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900">1,325,000</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>

                        {/* Original Value Fields */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <div>
                            <label className="block text-sm font-medium mb-1">Acquisition Cost (XOF)</label>
                            <input
                              type="number"
                              value={newAssetForm.acquisition_cost}
                              onChange={(e) => setNewAssetForm({...newAssetForm, acquisition_cost: Number(e.target.value)})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="0"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Historical APC (Acc. Prov. for Dep.)</label>
                            <input
                              type="number"
                              value={newAssetForm.historical_apc}
                              onChange={(e) => setNewAssetForm({...newAssetForm, historical_apc: Number(e.target.value)})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Net Book Value</label>
                            <input
                              type="number"
                              value={newAssetForm.net_book_value}
                              onChange={(e) => setNewAssetForm({...newAssetForm, net_book_value: Number(e.target.value)})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Historical NBC (Net Book Cost)</label>
                            <input
                              type="number"
                              value={newAssetForm.historical_nbc}
                              onChange={(e) => setNewAssetForm({...newAssetForm, historical_nbc: Number(e.target.value)})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Book Value at End</label>
                            <input
                              type="number"
                              value={newAssetForm.book_value_end || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, book_value_end: Number(e.target.value)})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Valeur comptable finale"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Salvage Value</label>
                            <input
                              type="number"
                              value={newAssetForm.salvage_value}
                              onChange={(e) => setNewAssetForm({...newAssetForm, salvage_value: Number(e.target.value)})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Depreciation Parameters Tab */}
                    {activeImmobilisationTab === 'depreciation-params' && (
                      <div className="space-y-6">
                        <div className="bg-orange-50 p-4 rounded-lg mb-6">
                          <h3 className="font-medium text-orange-800 mb-2">Paramètres d'amortissement</h3>
                          <p className="text-sm text-orange-600">Configuration des méthodes et taux d'amortissement</p>
                        </div>

                        {/* Asset information */}
                        <div>
                          <h4 className="text-lg font-semibold mb-4">Asset information</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-medium mb-1">Asset ID (Unique identifier)</label>
                              <input
                                type="text"
                                value="ID-00333"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"
                                readOnly
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Asset name/Description</label>
                              <input
                                type="text"
                                value="ARIC TRAVAUX D'ASSAINISSEMENT"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"
                                readOnly
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Asset category</label>
                              <select
                                value={newAssetForm.asset_category || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, asset_category: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              >
                                <option value="">Sélectionnez...</option>
                                <option value="buildings">Bâtiments</option>
                                <option value="equipment">Équipements</option>
                                <option value="vehicles">Véhicules</option>
                                <option value="infrastructure">Infrastructure</option>
                                <option value="land">Terrains</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Original cost</label>
                              <input
                                type="text"
                                value="59,160,515.00"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"
                                readOnly
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Additional costs</label>
                              <input
                                type="number"
                                value={newAssetForm.additional_costs || 0}
                                onChange={(e) => setNewAssetForm({...newAssetForm, additional_costs: Number(e.target.value)})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="0"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Total capitalized cost</label>
                              <input
                                type="text"
                                value="59,160,515.00"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"
                                readOnly
                              />
                            </div>
                          </div>
                        </div>

                        {/* Depreciation details */}
                        <div>
                          <h4 className="text-lg font-semibold mb-4">Depreciation details</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-medium mb-1">Depreciation method</label>
                              <select
                                value={newAssetForm.depreciation_method || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, depreciation_method: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              >
                                <option value="">-- Select --</option>
                                <option value="straight-line">Linéaire</option>
                                <option value="declining-balance">Dégressif</option>
                                <option value="units-of-production">Unités de production</option>
                                <option value="sum-of-years">Somme des annuités</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Depreciation start date</label>
                              <input
                                type="date"
                                value={newAssetForm.depreciation_start_date || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, depreciation_start_date: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="jj/mm/aaaa"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Depreciation end date</label>
                              <input
                                type="date"
                                value={newAssetForm.depreciation_end_date || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, depreciation_end_date: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="jj/mm/aaaa"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Useful life (Month)</label>
                              <input
                                type="number"
                                value={newAssetForm.useful_life_months || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, useful_life_months: Number(e.target.value)})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="life time in years"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Remaining life</label>
                              <input
                                type="number"
                                value={newAssetForm.remaining_life || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, remaining_life: Number(e.target.value)})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="Remaining life"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Depreciation type</label>
                              <select
                                value={newAssetForm.depreciation_type || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, depreciation_type: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              >
                                <option value="">Sélectionnez...</option>
                                <option value="normal">Normal</option>
                                <option value="accelerated">Accéléré</option>
                                <option value="special">Spécial</option>
                                <option value="fiscal">Fiscal</option>
                              </select>
                            </div>
                          </div>
                        </div>

                        {/* Reporting and verification */}
                        <div>
                          <h4 className="text-lg font-semibold mb-4">Reporting and verification</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-medium mb-1">Reporting frequency</label>
                              <select
                                value={newAssetForm.reporting_frequency || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, reporting_frequency: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              >
                                <option value="">Sélectionnez...</option>
                                <option value="monthly">Mensuel</option>
                                <option value="quarterly">Trimestriel</option>
                                <option value="semi-annual">Semestriel</option>
                                <option value="annual">Annuel</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Verification date</label>
                              <input
                                type="date"
                                value={newAssetForm.verification_date || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, verification_date: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="jj/mm/aaaa"
                              />
                            </div>
                            <div className="md:col-span-2">
                              <label className="block text-sm font-medium mb-1">Verification process</label>
                              <textarea
                                value={newAssetForm.verification_process || ''}
                                onChange={(e) => setNewAssetForm({...newAssetForm, verification_process: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                rows={3}
                                placeholder="Décrivez le processus de vérification..."
                              />
                            </div>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Depreciation Table Tab */}
                    {activeImmobilisationTab === 'depreciation-table' && (
                      <div className="space-y-6">
                        <div className="bg-purple-50 p-4 rounded-lg">
                          <h3 className="font-medium text-purple-800 mb-2">Tableau d'amortissement</h3>
                          <p className="text-sm text-purple-600">Plan d'amortissement détaillé par exercice</p>
                        </div>
                        <div className="overflow-x-auto">
                          <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                              <tr>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Beginning book value</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Depreciation expense</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Accumulated depreciation</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ending book value</th>
                              </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                              {(() => {
                                const originalCost = 59160515; // Coût d'origine de l'actif ARIC TRAVAUX D'ASSAINISSEMENT
                                const depreciationRate = 0.20; // Taux d'amortissement 20%
                                const annualDepreciation = originalCost * depreciationRate;
                                let accumulatedDepreciation = 0;
                                let totalDepreciationExpense = 0;

                                const years = [2021, 2022, 2023, 2024, 2025];
                                const rows = years.map((year, index) => {
                                  const beginningBookValue = index === 0 ? originalCost : originalCost - accumulatedDepreciation;
                                  const depreciationExpense = Math.min(annualDepreciation, beginningBookValue);
                                  accumulatedDepreciation += depreciationExpense;
                                  totalDepreciationExpense += depreciationExpense;
                                  const endingBookValue = originalCost - accumulatedDepreciation;

                                  return (
                                    <tr key={year}>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                        {year}
                                      </td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        {beginningBookValue.toLocaleString('fr-FR')}
                                      </td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        {depreciationExpense.toLocaleString('fr-FR')}
                                      </td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        {accumulatedDepreciation.toLocaleString('fr-FR')}
                                      </td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        {endingBookValue.toLocaleString('fr-FR')}
                                      </td>
                                    </tr>
                                  );
                                });

                                // Ajouter la ligne Year-end-totals
                                rows.push(
                                  <tr key="totals" className="bg-blue-50 font-semibold">
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">
                                      Year-end-totals
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">
                                      -
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">
                                      {totalDepreciationExpense.toLocaleString('fr-FR')}
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">
                                      {accumulatedDepreciation.toLocaleString('fr-FR')}
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">
                                      {(originalCost - accumulatedDepreciation).toLocaleString('fr-FR')}
                                    </td>
                                  </tr>
                                );

                                return rows;
                              })()}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    )}

                    {/* Cost Accounting Tab */}
                    {activeImmobilisationTab === 'cost-accounting' && (
                      <div className="space-y-6">
                        {/* Cost Accounting Table */}
                        <div>
                          <h4 className="text-lg font-medium mb-4">Cost accounting</h4>
                          <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                              <thead className="bg-gray-50">
                                <tr>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asset ID</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asset name/Description</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asset category</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acquisition date</th>
                                </tr>
                              </thead>
                              <tbody className="bg-white divide-y divide-gray-200">
                                <tr>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">FA001</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office building 1</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">15/01/2022</td>
                                </tr>
                                <tr>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">FA001</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office building 1</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">15/01/2022</td>
                                </tr>
                                <tr>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">FA001</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office building 1</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">15/01/2022</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>

                        {/* Original form fields */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <div>
                            <label className="block text-sm font-medium mb-1">Cost Center</label>
                            <input
                              type="text"
                              value={newAssetForm.cost_center || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, cost_center: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Ex: CC-PROD-001"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Profit Center</label>
                            <input
                              type="text"
                              value={newAssetForm.profit_center || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, profit_center: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Ex: PC-VENTE-001"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Internal Order</label>
                            <input
                              type="text"
                              value={newAssetForm.internal_order || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, internal_order: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Ex: IO-2024-001"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">WBS Element</label>
                            <input
                              type="text"
                              value={newAssetForm.wbs_element || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, wbs_element: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Ex: WBS-PROJ-001"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Settlement Rule</label>
                            <select
                              value={newAssetForm.settlement_rule || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, settlement_rule: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="">-- Règle de répartition --</option>
                              <option value="percentage">Pourcentage</option>
                              <option value="fixed-amount">Montant fixe</option>
                              <option value="equivalence">Équivalence</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Distribution %</label>
                            <input
                              type="number"
                              value={newAssetForm.distribution_percentage || ''}
                              onChange={(e) => setNewAssetForm({...newAssetForm, distribution_percentage: Number(e.target.value)})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Ex: 100"
                              min="0"
                              max="100"
                            />
                          </div>
                        </div>
                    )}
                  </div>
              )}

              {/* Section Données de vente */}
              {activeFormTab === 'vente' && (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label className="block text-sm font-medium mb-1">Sale Date</label>
                    <input
                      type="date"
                      value={newAssetForm.sale_date || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, sale_date: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Sale Price (XOF)</label>
                    <input
                      type="number"
                      value={newAssetForm.sale_price || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, sale_price: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Prix de vente"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Buyer</label>
                    <input
                      type="text"
                      value={newAssetForm.buyer || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, buyer: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Nom de l'acheteur"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Sale Reason</label>
                    <select
                      value={newAssetForm.sale_reason || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, sale_reason: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="">-- Sélectionner --</option>
                      <option value="obsolete">Obsolète</option>
                      <option value="damaged">Endommagé</option>
                      <option value="upgrade">Mise à niveau</option>
                      <option value="redundant">Redondant</option>
                    </select>
                  </div>
                </div>
              )}

              {/* Section Composants */}
              {activeFormTab === 'composants' && (
                <div className="space-y-6">
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <h3 className="font-medium text-blue-800 mb-2">Composants de l'actif</h3>
                    <p className="text-sm text-blue-600">Liste des composants qui constituent cet actif principal</p>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-medium mb-1">Main Component</label>
                      <input
                        type="text"
                        value={newAssetForm.main_component || ''}
                        onChange={(e) => setNewAssetForm({...newAssetForm, main_component: e.target.value})}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                        placeholder="Composant principal"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Secondary Components</label>
                      <textarea
                        value={newAssetForm.secondary_components || ''}
                        onChange={(e) => setNewAssetForm({...newAssetForm, secondary_components: e.target.value})}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                        rows={3}
                        placeholder="Liste des composants secondaires (un par ligne)"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Component Value (XOF)</label>
                      <input
                        type="number"
                        value={newAssetForm.component_value || ''}
                        onChange={(e) => setNewAssetForm({...newAssetForm, component_value: Number(e.target.value)})}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                        placeholder="Valeur des composants"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Component Count</label>
                      <input
                        type="number"
                        value={newAssetForm.component_count || ''}
                        onChange={(e) => setNewAssetForm({...newAssetForm, component_count: Number(e.target.value)})}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                        placeholder="Nombre de composants"
                      />
                    </div>
                  </div>
                </div>
              )}

              {/* Section Données de maintenance */}
              {activeFormTab === 'maintenance' && (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label className="block text-sm font-medium mb-1">Last Maintenance Date</label>
                    <input
                      type="date"
                      value={newAssetForm.last_maintenance || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, last_maintenance: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Next Maintenance Date</label>
                    <input
                      type="date"
                      value={newAssetForm.next_maintenance || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, next_maintenance: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Maintenance Frequency</label>
                    <select
                      value={newAssetForm.maintenance_frequency || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, maintenance_frequency: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="">-- Sélectionner --</option>
                      <option value="weekly">Hebdomadaire</option>
                      <option value="monthly">Mensuelle</option>
                      <option value="quarterly">Trimestrielle</option>
                      <option value="semi-annual">Semestrielle</option>
                      <option value="annual">Annuelle</option>
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Maintenance Cost (XOF)</label>
                    <input
                      type="number"
                      value={newAssetForm.maintenance_cost || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, maintenance_cost: Number(e.target.value)})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      placeholder="Coût de maintenance annuel"
                    />
                  </div>
                  <div className="md:col-span-2">
                    <label className="block text-sm font-medium mb-1">Maintenance Notes</label>
                    <textarea
                      value={newAssetForm.maintenance_notes || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, maintenance_notes: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      rows={3}
                      placeholder="Instructions et notes de maintenance..."
                    />
                  </div>
                </div>
              )}

              {/* Section Attachements */}
              {activeFormTab === 'attachements' && (
                <div className="space-y-6">
                  <div className="bg-green-50 p-4 rounded-lg">
                    <h3 className="font-medium text-green-800 mb-2">Documents et fichiers joints</h3>
                    <p className="text-sm text-green-600">Ajoutez des documents, photos, manuels et autres fichiers relatifs à cet actif</p>
                  </div>
                  <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                    <Upload className="w-12 h-12 text-gray-400 mx-auto mb-4" />
                    <p className="text-gray-600 mb-2">Glissez-déposez vos fichiers ici ou</p>
                    <ModernButton variant="outline" size="sm">
                      <Plus className="w-4 h-4 mr-1" />
                      Sélectionner des fichiers
                    </ModernButton>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-medium mb-1">Document Type</label>
                      <select
                        value={newAssetForm.document_type || ''}
                        onChange={(e) => setNewAssetForm({...newAssetForm, document_type: e.target.value})}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="">-- Type de document --</option>
                        <option value="invoice">Facture</option>
                        <option value="manual">Manuel</option>
                        <option value="warranty">Garantie</option>
                        <option value="photo">Photo</option>
                        <option value="certificate">Certificat</option>
                        <option value="contract">Contrat</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Document Description</label>
                      <input
                        type="text"
                        value={newAssetForm.document_description || ''}
                        onChange={(e) => setNewAssetForm({...newAssetForm, document_description: e.target.value})}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                        placeholder="Description du document"
                      />
                    </div>
                  </div>
                </div>
              )}

              {/* Section Notes */}
              {activeFormTab === 'notes' && (
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium mb-1">Notes générales</label>
                    <textarea
                      value={newAssetForm.notes}
                      onChange={(e) => setNewAssetForm({...newAssetForm, notes: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      rows={6}
                      placeholder="Notes, remarques et informations supplémentaires..."
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Notes techniques</label>
                    <textarea
                      value={newAssetForm.technical_notes || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, technical_notes: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      rows={4}
                      placeholder="Spécifications techniques, caractéristiques particulières..."
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Notes de sécurité</label>
                    <textarea
                      value={newAssetForm.security_notes || ''}
                      onChange={(e) => setNewAssetForm({...newAssetForm, security_notes: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      rows={3}
                      placeholder="Consignes de sécurité, précautions d'usage..."
                    />
                  </div>
                </div>
              )}
            </div>

            <div className="p-6 border-t border-gray-200">
              <div className="flex justify-end space-x-3">
                <ModernButton variant="outline" onClick={() => setShowNewAssetModal(false)}>
                  Annuler
                </ModernButton>
                <ModernButton variant="primary" onClick={handleSaveAsset}>
                  Créer l'actif
                </ModernButton>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Edit Asset Modal */}
      {showEditAssetModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-7xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6 border-b border-gray-200">
              <div className="flex items-center justify-between">
                <h2 className="text-xl font-bold">Asset Master Data - Modifier l'Actif</h2>
                <button
                  onClick={() => setShowEditAssetModal(false)}
                  className="text-gray-400 hover:text-gray-600"
                >
                  <X className="w-6 h-6" />
                </button>
              </div>
            </div>

            {/* Header with Photo and Asset Info */}
            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200 p-6">
              <div className="flex items-start space-x-6">
                {/* Photo Section */}
                <div className="flex-shrink-0">
                  <div className="w-32 h-32 bg-white border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center group hover:border-blue-400 transition-colors cursor-pointer">
                    {assetToEdit?.asset_photo ? (
                      <img
                        src={assetToEdit.asset_photo}
                        alt="Asset"
                        className="w-full h-full object-cover rounded-lg"
                      />
                    ) : (
                      <div className="text-center">
                        <Camera className="w-8 h-8 text-gray-400 mx-auto mb-2 group-hover:text-blue-500" />
                        <p className="text-xs text-gray-500 group-hover:text-blue-600">Modifier photo</p>
                      </div>
                    )}
                  </div>
                </div>

                {/* Asset Information Grid */}
                <div className="flex-1">
                  <div className="grid grid-cols-3 lg:grid-cols-5 gap-x-4 gap-y-3">
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Capital Appropriation Request Number</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {assetToEdit?.capital_appropriation_number || 'CAR-2024-001'}
                      </p>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Asset Number</label>
                      <p className="text-sm font-semibold text-blue-600 mt-0.5">
                        {assetToEdit?.asset_number || assetToEdit?.code || '235377'}
                      </p>
                    </div>
                    <div className="lg:col-span-3 flex items-start gap-4">
                      <div className="flex-1">
                        <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Description</label>
                        <p className="text-sm font-semibold text-gray-900 mt-0.5 leading-tight">
                          {assetToEdit?.description || assetToEdit?.designation || 'ARIC TRAVAUX D\'ASSAINISSEMENT'}
                        </p>
                      </div>
                      <div className="flex items-center">
                        <div className="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                        <div>
                          <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Status</label>
                          <p className="text-sm font-semibold text-green-700">
                            {assetToEdit?.status === 'en_service' ? 'En service' : 'Inactif'}
                          </p>
                        </div>
                      </div>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">UoM Group</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {assetToEdit?.uom_group || 'Unité'}
                      </p>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Asset Class</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {assetToEdit?.asset_class || '24 - matériel, mobilier'}
                      </p>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Asset Category</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {assetToEdit?.asset_category || assetToEdit?.category || 'Matériel technique'}
                      </p>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Asset Identification</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {assetToEdit?.asset_identification || 'ID-00333'}
                      </p>
                    </div>
                    <div>
                      <label className="text-xs font-medium text-gray-500 uppercase tracking-wide">Emplacement</label>
                      <p className="text-sm font-semibold text-gray-900 mt-0.5">
                        {assetToEdit?.location || 'EMPLACEMENT'}
                      </p>
                    </div>
                  </div>
                </div>

                {/* QR Code Section */}
                <div className="flex-shrink-0">
                  <div className="bg-white border border-gray-300 rounded-lg p-3 text-center shadow-sm">
                    <div className="w-16 h-16 bg-gray-100 border border-gray-200 rounded flex items-center justify-center mx-auto mb-2">
                      <QrCode className="w-10 h-10 text-gray-400" />
                    </div>
                    <p className="text-xs font-medium text-gray-700">Asset Master Data</p>
                    <p className="text-xs text-gray-500 mt-1">{assetToEdit?.asset_number || assetToEdit?.code || '235377'}</p>
                    <button className="mt-1 text-xs text-blue-600 hover:text-blue-800 font-medium">
                      Générer
                    </button>
                  </div>
                </div>
              </div>
            </div>

            {/* Layout avec Sidebar */}
            <div className="flex h-[60vh]">
              {/* Sidebar Navigation */}
              <div className="w-64 bg-gray-50 border-r border-gray-200 overflow-y-auto">
                <nav className="p-4 space-y-2">
                  {[
                    { id: 'general', label: 'Information générale', icon: Info },
                    { id: 'acquisition', label: 'Informations acquisition', icon: DollarSign },
                    { id: 'immobilisation', label: 'Immobilisation', icon: Building },
                    { id: 'vente', label: 'Données de vente', icon: TrendingDown },
                    { id: 'composants', label: 'Composants', icon: Package },
                    { id: 'maintenance', label: 'Données de maintenance', icon: Wrench },
                    { id: 'attachements', label: 'Attachements', icon: FileText },
                    { id: 'notes', label: 'Notes', icon: Edit }
                  ].map((section) => {
                    const IconComponent = section.icon;
                    return (
                      <button
                        key={section.id}
                        onClick={() => setActiveFormTab(section.id)}
                        className={`w-full flex items-center px-3 py-2 text-left rounded-lg transition-colors ${
                          activeFormTab === section.id
                            ? 'bg-blue-100 text-blue-700 font-medium'
                            : 'text-gray-700 hover:bg-gray-100'
                        }`}
                      >
                        <IconComponent className="w-4 h-4 mr-3" />
                        <span className="text-sm">{section.label}</span>
                      </button>
                    );
                  })}
                </nav>
              </div>

              {/* Content Area */}
              <div className="flex-1 p-6 overflow-y-auto">
                {/* Information générale */}
                {activeFormTab === 'general' && (
                  <div className="space-y-6">
                    <h3 className="text-lg font-semibold mb-4">Information générale</h3>

                    {/* Onglets horizontaux pour Information générale */}
                    <div className="border-b border-gray-200">
                      <nav className="flex space-x-8">
                        {[
                          { id: 'basic', label: 'Actif Info' },
                          { id: 'material', label: 'Material Data' },
                          { id: 'warranty', label: 'Warranty' },
                          { id: 'insurance', label: 'Insurance' },
                          { id: 'location', label: 'Location' }
                        ].map((tab) => (
                          <button
                            key={tab.id}
                            onClick={() => setActiveGeneralTab(tab.id)}
                            className={`py-2 px-1 border-b-2 font-medium text-sm ${
                              activeGeneralTab === tab.id
                                ? 'border-blue-500 text-blue-600'
                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                            }`}
                          >
                            {tab.label}
                          </button>
                        ))}
                      </nav>
                    </div>

                    {/* Contenu des onglets Information générale */}
                    {activeGeneralTab === 'basic' && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-medium mb-1">Asset Number</label>
                            <input
                              type="text"
                              value={assetToEdit?.asset_number || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Ex: 235377"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Description *</label>
                            <input
                              type="text"
                              value={assetToEdit?.description || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Ex: ARIC TRAVAUX D'ASSAINISSEMENT"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Asset Class *</label>
                            <select
                              value={assetToEdit?.asset_class || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="">-- Select --</option>
                              <option value="21 - équipement informatique">21 - équipement informatique</option>
                              <option value="22 - équipement médical">22 - équipement médical</option>
                              <option value="23 - véhicules">23 - véhicules</option>
                              <option value="24 - matériel, mobilier">24 - matériel, mobilier</option>
                              <option value="25 - immobilisations incorporelles">25 - immobilisations incorporelles</option>
                            </select>
                          </div>
                        </div>
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-medium mb-1">Asset Category</label>
                            <input
                              type="text"
                              value={assetToEdit?.asset_category || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Ex: Matériel technique"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">UoM Group</label>
                            <select
                              value={assetToEdit?.uom_group || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="Unité">Unité</option>
                              <option value="Mètre">Mètre</option>
                              <option value="Kilogramme">Kilogramme</option>
                              <option value="Litre">Litre</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Asset Identification</label>
                            <input
                              type="text"
                              value={assetToEdit?.asset_identification || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Ex: ID-00333"
                            />
                          </div>
                        </div>
                      </div>
                    )}

                    {activeGeneralTab === 'material' && (
                      <div className="space-y-4">
                        <p className="text-gray-600">Informations sur les matériaux et spécifications techniques.</p>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <div>
                            <label className="block text-sm font-medium mb-1">Manufacturer</label>
                            <input type="text" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Model</label>
                            <input type="text" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Serial Number</label>
                            <input type="text" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Batch Number</label>
                            <input type="text" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                        </div>
                      </div>
                    )}

                    {activeGeneralTab === 'warranty' && (
                      <div className="space-y-4">
                        <p className="text-gray-600">Informations de garantie et support.</p>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <div>
                            <label className="block text-sm font-medium mb-1">Warranty Start Date</label>
                            <input type="date" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Warranty End Date</label>
                            <input
                              type="date"
                              value={assetToEdit?.warranty_end || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Warranty Provider</label>
                            <input type="text" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Support Contact</label>
                            <input type="text" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                        </div>
                      </div>
                    )}

                    {activeGeneralTab === 'insurance' && (
                      <div className="space-y-4">
                        <p className="text-gray-600">Informations d'assurance et couverture.</p>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <div>
                            <label className="block text-sm font-medium mb-1">Insurance Company</label>
                            <input type="text" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Policy Number</label>
                            <input type="text" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Coverage Amount</label>
                            <input type="number" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Expiry Date</label>
                            <input type="date" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                          </div>
                        </div>
                      </div>
                    )}

                    {activeGeneralTab === 'location' && (
                      <div className="space-y-4">
                        <p className="text-gray-600">Localisation et emplacement de l'actif.</p>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <div>
                            <label className="block text-sm font-medium mb-1">Location</label>
                            <input
                              type="text"
                              value={assetToEdit?.location || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Emplacement"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Technician</label>
                            <select
                              value={assetToEdit?.technician || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="">Sélectionnez...</option>
                              <option value="Amadou Diallo">Amadou Diallo</option>
                              <option value="Mohamed Kane">Mohamed Kane</option>
                              <option value="Cheikh Diop">Cheikh Diop</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Employee</label>
                            <select
                              value={assetToEdit?.employee || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="">Sélectionnez...</option>
                              <option value="Fatima Ndiaye">Fatima Ndiaye</option>
                              <option value="Moussa Seck">Moussa Seck</option>
                              <option value="Aminata Fall">Aminata Fall</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Department</label>
                            <input
                              type="text"
                              value={assetToEdit?.department || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Département"
                            />
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                )}

                {/* Autres sections de la sidebar */}
                {activeFormTab === 'acquisition' && (
                  <div className="space-y-6">
                    <h3 className="text-lg font-semibold mb-4">Informations d'acquisition</h3>

                    {/* Vendor/Supplier Information Section */}
                    <div className="bg-gray-50 p-4 rounded-lg space-y-4">
                      <h4 className="font-medium text-gray-900 mb-3">Vendor/Supplier Information</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium mb-1">Vendor Name *</label>
                          <input
                            type="text"
                            value={assetToEdit?.supplier || ''}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Nom du fournisseur"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Vendor Contact Information</label>
                          <input
                            type="text"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Email / Téléphone"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Document Number</label>
                          <input
                            type="text"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="N° de document"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Purchase Order Number</label>
                          <input
                            type="text"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="N° de bon de commande"
                          />
                        </div>
                      </div>
                    </div>

                    {/* Purchase Details Section */}
                    <div className="bg-blue-50 p-4 rounded-lg space-y-4">
                      <h4 className="font-medium text-gray-900 mb-3">Purchase Details</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium mb-1">Acquisition Date *</label>
                          <input
                            type="date"
                            value={assetToEdit?.acquisition_date || ''}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Acquisition Cost *</label>
                          <input
                            type="number"
                            value={assetToEdit?.acquisition_cost || ''}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Montant d'achat"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Payment Terms</label>
                          <select
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">-- Sélectionnez --</option>
                            <option value="cash">Comptant</option>
                            <option value="30days">30 jours</option>
                            <option value="60days">60 jours</option>
                            <option value="90days">90 jours</option>
                            <option value="installments">Échelonné</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Purchase Amount</label>
                          <input
                            type="number"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Montant total"
                          />
                        </div>
                      </div>
                    </div>

                    {/* Asset Address and Ownership Section */}
                    <div className="bg-green-50 p-4 rounded-lg space-y-4">
                      <h4 className="font-medium text-gray-900 mb-3">Asset Address and Ownership</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="md:col-span-2">
                          <label className="block text-sm font-medium mb-1">Delivery Address</label>
                          <textarea
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            rows={2}
                            placeholder="Adresse de livraison complète"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Owner</label>
                          <input
                            type="text"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Propriétaire de l'actif"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Capital Appropriation Request Number</label>
                          <input
                            type="text"
                            value={assetToEdit?.capital_appropriation_number || ''}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Ex: CAR-2024-001"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {activeFormTab === 'immobilisation' && (
                  <div className="flex flex-col h-full">
                    <h3 className="text-lg font-semibold mb-4">Immobilisation</h3>

                    {/* Onglets horizontaux pour Immobilisation - Fixed Header */}
                    <div className="border-b border-gray-200 sticky top-0 bg-white z-10">
                      <nav className="flex space-x-8 overflow-x-auto">
                        {[
                          { id: 'overview', label: 'Overview' },
                          { id: 'values', label: 'Values' },
                          { id: 'depreciation-params', label: 'Depreciation parameters' },
                          { id: 'depreciation-table', label: 'Depreciation table' },
                          { id: 'cost-accounting', label: 'Cost accounting' },
                          { id: 'changes-tracking', label: 'Changes tracking' }
                        ].map((tab) => (
                          <button
                            key={tab.id}
                            onClick={() => setActiveImmobilisationTab(tab.id)}
                            className={`py-2 px-1 border-b-2 font-medium text-sm ${
                              activeImmobilisationTab === tab.id
                                ? 'border-blue-500 text-blue-600'
                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                            }`}
                          >
                            {tab.label}
                          </button>
                        ))}
                      </nav>
                    </div>

                    {/* Tab Content - Scrollable */}
                    <div className="flex-1 overflow-y-auto mt-6">
                      {activeImmobilisationTab === 'overview' && (
                      <div className="space-y-6">
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                          {/* Depreciation Info */}
                          <div>
                            <label className="block text-sm font-medium mb-1">Asset Group</label>
                            <input
                              type="text"
                              value={assetToEdit?.asset_group || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Groupe d'actifs"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Depreciation Group</label>
                            <input
                              type="text"
                              value={assetToEdit?.depreciation_group || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Groupe d'amortissement"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Depreciation Method</label>
                            <select
                              value={assetToEdit?.depreciation_method || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="">-- Select --</option>
                              <option value="Linéaire">Linéaire</option>
                              <option value="Dégressif">Dégressif</option>
                              <option value="Unités de production">Unités de production</option>
                              <option value="Somme des chiffres">Somme des chiffres</option>
                            </select>
                          </div>

                          {/* Asset Info */}
                          <div>
                            <label className="block text-sm font-medium mb-1">Serial Number</label>
                            <input
                              type="text"
                              value={assetToEdit?.serial_number || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Numéro de série"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Location</label>
                            <input
                              type="text"
                              value={assetToEdit?.location || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="Emplacement"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Technician</label>
                            <select
                              value={assetToEdit?.technician || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="">Sélectionnez...</option>
                              <option value="Amadou Diallo">Amadou Diallo</option>
                              <option value="Mohamed Kane">Mohamed Kane</option>
                              <option value="Cheikh Diop">Cheikh Diop</option>
                            </select>
                          </div>

                          <div>
                            <label className="block text-sm font-medium mb-1">Employee</label>
                            <select
                              value={assetToEdit?.employee || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="">Sélectionnez...</option>
                              <option value="Fatima Ndiaye">Fatima Ndiaye</option>
                              <option value="Moussa Seck">Moussa Seck</option>
                              <option value="Aminata Fall">Aminata Fall</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Capitalization Date</label>
                            <input
                              type="date"
                              value={assetToEdit?.capitalization_date || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="jj/mm/aaaa"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Quantity</label>
                            <input
                              type="number"
                              value={assetToEdit?.quantity || 1}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              min="1"
                            />
                          </div>

                          {/* Financial Values */}
                          <div>
                            <label className="block text-sm font-medium mb-1">Historical APC (Acc. Prov. for Dep.)</label>
                            <input
                              type="number"
                              value={assetToEdit?.historical_apc || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="0"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Acquisition Cost</label>
                            <input
                              type="number"
                              value={assetToEdit?.acquisition_cost || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="0"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Net Book Value</label>
                            <input
                              type="number"
                              value={assetToEdit?.net_book_value || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="0"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Historical NBC (Net Book Cost)</label>
                            <input
                              type="number"
                              value={assetToEdit?.historical_nbc || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="0"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Ordinary Depreciation</label>
                            <input
                              type="number"
                              value={assetToEdit?.ordinary_depreciation || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="0"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Unplanned Depreciation</label>
                            <input
                              type="number"
                              value={assetToEdit?.unplanned_depreciation || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="0"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Special Depreciation</label>
                            <input
                              type="number"
                              value={assetToEdit?.special_depreciation || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="0"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Write-up</label>
                            <input
                              type="number"
                              value={assetToEdit?.write_up || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="0"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Salvage Value</label>
                            <input
                              type="number"
                              value={assetToEdit?.salvage_value || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              placeholder="0"
                            />
                          </div>
                        </div>
                      </div>
                    )}

                    {activeImmobilisationTab === 'values' && (
                      <div className="space-y-4">
                        <p className="text-gray-600">Gestion des valeurs et montants.</p>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <div>
                            <label className="block text-sm font-medium mb-1">Coût d'acquisition</label>
                            <input
                              type="number"
                              value={assetToEdit?.acquisition_cost || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Valeur de récupération</label>
                            <input
                              type="number"
                              value={assetToEdit?.salvage_value || ''}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                          </div>
                        </div>

                        {/* Depreciation Area Section */}
                        <div className="mt-6 space-y-4">
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-medium mb-1">Depreciation Area</label>
                              <select className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionnez...</option>
                                <option value="fiscal">Zone fiscale</option>
                                <option value="comptable">Zone comptable</option>
                                <option value="ifrs">Zone IFRS</option>
                                <option value="management">Zone de gestion</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Fiscal Year</label>
                              <select className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionnez...</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                              </select>
                            </div>
                          </div>

                          {/* Depreciation Table */}
                          <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                              <thead className="bg-gray-50">
                                <tr>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Transaction</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acquisition and production costs</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Depreciation</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Write-up</th>
                                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Net Book Value</th>
                                </tr>
                              </thead>
                              <tbody className="bg-white divide-y divide-gray-200">
                                {/* Beginning of year */}
                                <tr className="bg-blue-50">
                                  <td className="px-4 py-3 text-sm font-semibold text-blue-900" colSpan={2}>Beginning of year</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">1,500,000</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">1</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">300,000</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">1,200,000</td>
                                </tr>

                                {/* Transactions */}
                                <tr>
                                  <td className="px-4 py-3 text-sm text-gray-900">1</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">Acquisition</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">250,000</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">1</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">250,000</td>
                                </tr>
                                <tr>
                                  <td className="px-4 py-3 text-sm text-gray-900">2</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">Amortissement annuel</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">175,000</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">-175,000</td>
                                </tr>
                                <tr>
                                  <td className="px-4 py-3 text-sm text-gray-900">3</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">Réévaluation</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">0</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">50,000</td>
                                  <td className="px-4 py-3 text-sm text-gray-900">50,000</td>
                                </tr>

                                {/* End of year */}
                                <tr className="bg-green-50">
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900" colSpan={2}>End of year</td>
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900">1,750,000</td>
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900">2</td>
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900">475,000</td>
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900">50,000</td>
                                  <td className="px-4 py-3 text-sm font-semibold text-green-900">1,325,000</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Depreciation Parameters Tab */}
                    {activeImmobilisationTab === 'depreciation-params' && (
                      <div className="space-y-6">
                        {/* Asset information */}
                        <div>
                          <h4 className="text-lg font-semibold mb-4">Asset information</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-medium mb-1">Asset ID (Unique identifier)</label>
                              <input
                                type="text"
                                value="ID-00333"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"
                                readOnly
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Asset name/Description</label>
                              <input
                                type="text"
                                value="ARIC TRAVAUX D'ASSAINISSEMENT"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"
                                readOnly
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Asset category</label>
                              <select className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionnez...</option>
                                <option value="buildings">Bâtiments</option>
                                <option value="equipment">Équipements</option>
                                <option value="vehicles">Véhicules</option>
                                <option value="infrastructure">Infrastructure</option>
                                <option value="land">Terrains</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Original cost</label>
                              <input
                                type="text"
                                value="59,160,515.00"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"
                                readOnly
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Additional costs</label>
                              <input
                                type="number"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="0"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Total capitalized cost</label>
                              <input
                                type="text"
                                value="59,160,515.00"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"
                                readOnly
                              />
                            </div>
                          </div>
                        </div>

                        {/* Depreciation details */}
                        <div>
                          <h4 className="text-lg font-semibold mb-4">Depreciation details</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-medium mb-1">Depreciation method</label>
                              <select className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">-- Select --</option>
                                <option value="straight-line">Linéaire</option>
                                <option value="declining-balance">Dégressif</option>
                                <option value="units-of-production">Unités de production</option>
                                <option value="sum-of-years">Somme des annuités</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Depreciation start date</label>
                              <input
                                type="date"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="jj/mm/aaaa"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Depreciation end date</label>
                              <input
                                type="date"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="jj/mm/aaaa"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Useful life (Month)</label>
                              <input
                                type="number"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="life time in years"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Remaining life</label>
                              <input
                                type="number"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="Remaining life"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Depreciation type</label>
                              <select className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionnez...</option>
                                <option value="normal">Normal</option>
                                <option value="accelerated">Accéléré</option>
                                <option value="special">Spécial</option>
                                <option value="fiscal">Fiscal</option>
                              </select>
                            </div>
                          </div>
                        </div>

                        {/* Reporting and verification */}
                        <div>
                          <h4 className="text-lg font-semibold mb-4">Reporting and verification</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-medium mb-1">Reporting frequency</label>
                              <select className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionnez...</option>
                                <option value="monthly">Mensuel</option>
                                <option value="quarterly">Trimestriel</option>
                                <option value="semi-annual">Semestriel</option>
                                <option value="annual">Annuel</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Verification date</label>
                              <input
                                type="date"
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="jj/mm/aaaa"
                              />
                            </div>
                            <div className="md:col-span-2">
                              <label className="block text-sm font-medium mb-1">Verification process</label>
                              <textarea
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                rows={3}
                                placeholder="Décrivez le processus de vérification..."
                              />
                            </div>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Depreciation Table Tab */}
                    {activeImmobilisationTab === 'depreciation-table' && (
                      <div className="space-y-6">
                        <div className="overflow-x-auto">
                          <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                              <tr>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Beginning book value</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Depreciation expense</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Accumulated depreciation</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ending book value</th>
                              </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                              {(() => {
                                const originalCost = assetToEdit?.acquisition_cost || 59160515;
                                const depreciationRate = 0.20;
                                const annualDepreciation = originalCost * depreciationRate;
                                let accumulatedDepreciation = 0;
                                let totalDepreciationExpense = 0;

                                const years = [2021, 2022, 2023, 2024, 2025];
                                const rows = years.map((year, index) => {
                                  const beginningBookValue = index === 0 ? originalCost : originalCost - accumulatedDepreciation;
                                  const depreciationExpense = Math.min(annualDepreciation, beginningBookValue);
                                  accumulatedDepreciation += depreciationExpense;
                                  totalDepreciationExpense += depreciationExpense;
                                  const endingBookValue = originalCost - accumulatedDepreciation;

                                  return (
                                    <tr key={year}>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{year}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{beginningBookValue.toLocaleString('fr-FR')}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{depreciationExpense.toLocaleString('fr-FR')}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{accumulatedDepreciation.toLocaleString('fr-FR')}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{endingBookValue.toLocaleString('fr-FR')}</td>
                                    </tr>
                                  );
                                });

                                rows.push(
                                  <tr key="totals" className="bg-blue-50 font-semibold">
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">Year-end-totals</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">-</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">{totalDepreciationExpense.toLocaleString('fr-FR')}</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">{accumulatedDepreciation.toLocaleString('fr-FR')}</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">{(originalCost - accumulatedDepreciation).toLocaleString('fr-FR')}</td>
                                  </tr>
                                );

                                return rows;
                              })()}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    )}

                    {/* Cost Accounting Tab */}
                    {activeImmobilisationTab === 'cost-accounting' && (
                      <div className="space-y-6">
                        <div>
                          <h4 className="text-lg font-medium mb-4">Cost accounting</h4>
                          <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                              <thead className="bg-gray-50">
                                <tr>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asset ID</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asset name/Description</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asset category</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acquisition date</th>
                                </tr>
                              </thead>
                              <tbody className="bg-white divide-y divide-gray-200">
                                <tr>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">FA001</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office building 1</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">15/01/2022</td>
                                </tr>
                                <tr>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">FA001</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office building 1</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">15/01/2022</td>
                                </tr>
                                <tr>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">FA001</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Furniture</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office building 1</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">15/01/2022</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Changes Tracking Tab */}
                    {activeImmobilisationTab === 'changes-tracking' && (
                      <div className="space-y-6">
                        <div className="mt-8">
                          <h4 className="text-lg font-medium mb-4">Historique des modifications</h4>
                          <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                              <thead className="bg-gray-50">
                                <tr>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date du<br/>changement</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Numéro<br/>de l'actif</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Description<br/>de l'actif</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Type de<br/>changement</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ancienne<br/>valeur</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nouvelle<br/>valeur</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ancien<br/>centre de coût</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nouveau<br/>centre de coût</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ancienne<br/>méthode de<br/>dépréciation</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nouvelle<br/>méthode de<br/>dépréciation</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ancienne<br/>durée de vie<br/>estimée</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nouvelle<br/>durée de vie<br/>estimée</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ancienne<br/>Valeur<br/>résiduelle</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nouvelle<br/>Valeur<br/>résiduelle</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Responsable<br/>du changement</th>
                                  <th className="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Commentaires</th>
                                </tr>
                              </thead>
                              <tbody className="bg-white divide-y divide-gray-200">
                                {[1, 2, 3].map((idx) => (
                                  <tr key={idx}>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">20/08/2024</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">12345</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Ordinateur portable</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">
                                      <span className="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">Réévaluation</span>
                                    </td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Centre A</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Centre B</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Linéaire</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Dégressif</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">5 ans</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">4 ans</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">999,999,999</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">Pamela Atokouna</td>
                                    <td className="px-3 py-2 whitespace-nowrap text-xs text-gray-900">
                                      <button className="text-gray-400 hover:text-gray-600">
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01" />
                                        </svg>
                                      </button>
                                    </td>
                                  </tr>
                                ))}
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Autres onglets d'immobilisation */}
                    {activeImmobilisationTab !== 'overview' &&
                     activeImmobilisationTab !== 'values' &&
                     activeImmobilisationTab !== 'depreciation-params' &&
                     activeImmobilisationTab !== 'depreciation-table' &&
                     activeImmobilisationTab !== 'cost-accounting' &&
                     activeImmobilisationTab !== 'changes-tracking' && (
                      <div className="space-y-4">
                        <p className="text-gray-600">Contenu pour {activeImmobilisationTab} - À implémenter</p>
                      </div>
                    )}
                    </div>
                  </div>
                )}

                {/* Autres sections */}
                {activeFormTab === 'vente' && (
                  <div className="space-y-4">
                    <h3 className="text-lg font-semibold mb-4">Données de vente</h3>
                    <p className="text-gray-600">Informations relatives à la vente ou cession de l'actif.</p>
                  </div>
                )}

                {activeFormTab === 'composants' && (
                  <div className="space-y-4">
                    <h3 className="text-lg font-semibold mb-4">Composants</h3>
                    <p className="text-gray-600">Liste des composants et pièces de l'actif.</p>
                  </div>
                )}

                {activeFormTab === 'maintenance' && (
                  <div className="space-y-4">
                    <h3 className="text-lg font-semibold mb-4">Données de maintenance</h3>
                    <p className="text-gray-600">Historique et planification des maintenances.</p>
                  </div>
                )}

                {activeFormTab === 'attachements' && (
                  <div className="space-y-4">
                    <h3 className="text-lg font-semibold mb-4">Attachements</h3>
                    <p className="text-gray-600">Documents et fichiers associés à l'actif.</p>
                  </div>
                )}

                {activeFormTab === 'notes' && (
                  <div className="space-y-4">
                    <h3 className="text-lg font-semibold mb-4">Notes</h3>
                    <textarea
                      value={assetToEdit?.notes || ''}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-32"
                      placeholder="Notes et observations..."
                    />
                  </div>
                )}
              </div>
            </div>

            {/* Footer Actions */}
            <div className="p-6 border-t border-gray-200">
              <div className="flex justify-end space-x-3">
                <ModernButton variant="outline" onClick={() => setShowEditAssetModal(false)}>
                  Annuler
                </ModernButton>
                <ModernButton variant="primary" onClick={handleSaveAsset}>
                  Sauvegarder les modifications
                </ModernButton>
              </div>
            </div>
          </div>
        </div>
      </div>
      )}

      {/* Delete Confirmation Modal */}
      {showDeleteConfirmModal && assetToDelete && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-md w-full">
            <div className="p-6">
              <div className="flex items-center mb-4">
                <AlertTriangle className="w-6 h-6 text-red-600 mr-3" />
                <h3 className="text-lg font-bold">Confirmer la suppression</h3>
              </div>
              <p className="text-gray-600 mb-6">
                Êtes-vous sûr de vouloir supprimer l'actif <strong>{assetToDelete.designation}</strong> ? Cette action est irréversible.
              </p>
              <div className="flex justify-end space-x-3">
                <ModernButton variant="outline" onClick={() => setShowDeleteConfirmModal(false)}>
                  Annuler
                </ModernButton>
                <ModernButton variant="primary" onClick={confirmDeleteAsset} className="bg-red-600 hover:bg-red-700">
                  Supprimer
                </ModernButton>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Export Modal */}
      {showExportModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-md w-full">
            <div className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="text-lg font-bold">Exporter le Registre</h3>
                <button
                  onClick={() => setShowExportModal(false)}
                  className="text-gray-400 hover:text-gray-600"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
              <div className="space-y-3">
                <ModernButton
                  variant="outline"
                  className="w-full justify-start"
                  onClick={exportToCSV}
                >
                  <FileText className="w-4 h-4 mr-2" />
                  Exporter en CSV
                </ModernButton>
                <ModernButton
                  variant="outline"
                  className="w-full justify-start"
                  onClick={exportToPDF}
                >
                  <FileText className="w-4 h-4 mr-2" />
                  Exporter en PDF
                </ModernButton>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Import Modal */}
      {showImportModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-md w-full">
            <div className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="text-lg font-bold">Importer des Actifs</h3>
                <button
                  onClick={() => setShowImportModal(false)}
                  className="text-gray-400 hover:text-gray-600"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2">Fichier Excel</label>
                  <input
                    type="file"
                    accept=".xlsx,.xls,.csv"
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <div className="text-sm text-gray-600">
                  <p>Formats acceptés: .xlsx, .xls, .csv</p>
                  <p>Colonnes requises: Code, Désignation, Catégorie, Valeur d'acquisition</p>
                </div>
                <div className="flex justify-end space-x-3 mt-6">
                  <ModernButton variant="outline" onClick={() => setShowImportModal(false)}>
                    Annuler
                  </ModernButton>
                  <ModernButton variant="primary" onClick={() => setShowImportModal(false)}>
                    Importer
                  </ModernButton>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* QR Scanner Modal */}
      {showQrScannerModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-md w-full">
            <div className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="text-lg font-bold">Scanner QR Code</h3>
                <button
                  onClick={() => setShowQrScannerModal(false)}
                  className="text-gray-400 hover:text-gray-600"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
              <div className="text-center space-y-4">
                <div className="mx-auto w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center">
                  <QrCode className="w-16 h-16 text-gray-400" />
                </div>
                <p className="text-sm text-gray-600">
                  Pointez votre caméra vers un QR code d'actif pour le scanner
                </p>
                <ModernButton variant="primary" onClick={() => setShowQrScannerModal(false)}>
                  Fermer
                </ModernButton>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};